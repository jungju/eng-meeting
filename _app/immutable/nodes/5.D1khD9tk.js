import"../chunks/NZTpNUN0.js";import"../chunks/DUMHf_my.js";import{p as oe,ag as F,ah as le,t as z,f as ne,a as S,b as de,s as h,g as e,d as s,e as m,q as t,ak as pe,m as R,r as p,h as C}from"../chunks/bplG7q_8.js";import{e as I,s as E}from"../chunks/CyL3djLh.js";import{i as T}from"../chunks/Cf2Bun1O.js";import{e as ve,i as ce}from"../chunks/CPKHhc1S.js";import{s as V}from"../chunks/CWIKjPFz.js";import{s as me}from"../chunks/DzyRjOIa.js";import{s as G}from"../chunks/N0OzDCDk.js";import{b as fe}from"../chunks/CgFHA2ll.js";import{i as ue}from"../chunks/BaxgYlCQ.js";import{s as ge,a as he}from"../chunks/CH-E4zoY.js";import{o as _e,a as $e}from"../chunks/C6rqwIBa.js";import{p as ke}from"../chunks/BW49INhP.js";import{b as be}from"../chunks/UoA9eOa8.js";import{C as ye}from"../chunks/BtjfU33a.js";var xe=z('<div class="photo svelte-1d2haii"><div class="label svelte-1d2haii"> </div> <img class="svelte-1d2haii"></div>'),we=z('<div class="kor svelte-1d2haii"> </div>'),Se=z('<div><div class="speaker svelte-1d2haii"> </div> <div class="text"> </div> <!></div>'),Ee=z('<div class="wrap svelte-1d2haii"><div class="main svelte-1d2haii"><!> <div class="dialogue svelte-1d2haii"></div></div></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function Ve(H,J){oe(J,!1);const[L,Q]=ge(),j=()=>he(ke,"$page",L),k=s(),f=s(),A=s();let n=s([]),b=s({}),i=s(-1),v=s(!1),c=s("none"),y=s("1.2em"),_=s(!0),$=s(!0),o=s();_e(async()=>{if(!e(k))return;const a=await fetch(`${e(f)}/dialogue.json`);if(!a.ok)return;const r=await a.json();t(b,r.persons),t(n,r.conversation.map((d,l)=>({...d,file:`${e(f)}/audio/${String(l+1).padStart(2,"0")}.mp3`})))}),$e(()=>e(o)?.pause());async function u(a,r=!0){if(a<0||a>=e(n).length){t(v,!1);return}t(i,a),await pe(),document.getElementById(`segment-${a}`)?.scrollIntoView({behavior:"smooth",block:"center"}),e(o).pause(),R(o,e(o).src=e(n)[a].file),R(o,e(o).muted=!!e(b)[e(n)[a].speaker]?.hideEnglish);try{await e(o).play()}catch{t(v,!1);return}t(v,!0)}function U(){e(c)==="segment"?u(e(i),!1):e(i)<e(n).length-1?u(e(i)+1):e(c)==="all"?u(0):t(v,!1)}function W(){e(v)?(e(o).pause(),t(v,!1)):e(i)===-1?u(0):u(e(i),!1)}function X(){t(c,e(c)==="none"?"all":e(c)==="all"?"segment":"none")}function Y(a){a.target.src=`${e(f)}/ready.webp`}function Z(a){switch(a.detail.id){case"play":W();break;case"repeat":X();break;case"kor":t(_,!e(_));break;case"size":t(y,e(y)==="1.2em"?"2em":"1.2em");break;case"photo":t($,!e($));break}}F(()=>j(),()=>{t(k,j().url.pathname.match(/\/dialogue\/([^\/]+)/)?.[1]||"")}),F(()=>e(k),()=>{t(f,`${be}/assets/dialogue/${e(k)}`)}),F(()=>(e(v),e(c),e(_),e($)),()=>{t(A,[{id:"play",icon:e(v)?"⏸":"▶"},{id:"repeat",text:`반복:${e(c)==="none"?"없음":e(c)==="all"?"전체":"구간"}`},{id:"kor",text:e(_)?"한글 ON":"한글 OFF"},{id:"size",text:"크기"},{id:"photo",text:e($)?"사진 ON":"사진 OFF"}])}),le(),ue();var M=Ee(),O=ne(M),N=m(O),P=m(N);{var ee=a=>{var r=xe(),d=m(r),l=m(d,!0);p(d);var g=h(d,2);p(r),C(()=>{E(l,e(b)[e(n)[e(i)]?.speaker]?.name||""),V(g,"src",e(n)[e(i)]?.speaker?`${e(f)}/${e(n)[e(i)].speaker}.webp`:`${e(f)}/ready.webp`)}),I("error",g,Y),S(a,r)};T(P,a=>{e($)&&a(ee)})}var q=h(P,2);ve(q,5,()=>e(n),ce,(a,r,d)=>{var l=Se();V(l,"id",`segment-${d}`);var g=m(l),ae=m(g);p(g);var x=h(g,2),te=m(x,!0);p(x);var se=h(x,2);{var re=B=>{var w=we(),ie=m(w,!0);p(w),C(()=>{G(w,`font-size:${e(y)??""}`),E(ie,e(r).korean)}),S(B,w)};T(se,B=>{e(_)&&B(re)})}p(l),C(()=>{me(l,1,`seg ${d===e(i)?"active":""}`,"svelte-1d2haii"),E(ae,`${e(b)[e(r).speaker]?.name??""}:`),G(x,`font-size:${e(y)??""}`),E(te,e(r).text)}),I("click",l,()=>u(d)),S(a,l)}),p(q),p(N),p(O);var D=h(O,2);ye(D,{get buttons(){return e(A)},$$events:{click:Z}});var K=h(D,2);fe(K,a=>t(o,a),()=>e(o)),I("ended",K,U),S(H,M),de(),Q()}export{Ve as component};
