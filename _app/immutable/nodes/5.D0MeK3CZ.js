import{t as k,a as h,s as z,e as H}from"../chunks/CMAwb4th.js";import"../chunks/CthApk8F.js";import{a6 as He,g as e,e as a,a7 as i,a8 as Te,f as re,a9 as Ue,a as s,s as u,ac as We,ab as qe,aa as Xe,m as me,c as g,r as _,t as T,O as Fe}from"../chunks/DnBkWd9o.js";import{i as K}from"../chunks/3lh4epU4.js";import{e as Je,i as Pe}from"../chunks/D7qEBDdj.js";import{s as Qe}from"../chunks/DH_McDNf.js";import{b as Ve}from"../chunks/M8wP0stW.js";import{i as Ye}from"../chunks/RqZXrTMm.js";import{s as Ze,a as et}from"../chunks/CKqP-jYq.js";import{o as tt,a as at}from"../chunks/xvpwIJTT.js";import{p as st}from"../chunks/CG-J5PH0.js";import{b as rt}from"../chunks/CHDfB7Nn.js";import{C as nt}from"../chunks/My-eeozF.js";var ot=k('<div class="remain-big svelte-s4lrgb"> </div>'),lt=k('<p class="kor svelte-s4lrgb"> </p>'),it=k('<p class="eng svelte-s4lrgb"> </p>'),ct=k('<p class="placeholder svelte-s4lrgb">•••</p>'),pt=k("<!> <!>",1),vt=k('<div role="button" tabindex="0"><div class="order-big svelte-s4lrgb"> </div> <!> <!></div> <button class="next-btn svelte-s4lrgb">NEXT ⏭</button>',1),dt=k('<div class="result-item svelte-s4lrgb" role="button" tabindex="0"><span class="num svelte-s4lrgb"></span><span class="eng txt svelte-s4lrgb"> </span><span class="kor txt svelte-s4lrgb"> </span></div>'),ft=k('<div class="result-list svelte-s4lrgb"><h2 class="svelte-s4lrgb">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),ut=k('<main class="wrapper svelte-s4lrgb"><!> <!></main> <!> <audio playsinline="" preload="auto" class="svelte-s4lrgb"></audio>',1);function At(be,he){He(he,!1);const[ke,xe]=Ze(),ne=()=>et(st,"$page",ke),J=s(),L=s(),oe=s(),le=s(),w=s(),x=s(),P=s(),U=s(),Q=s(),V=s(),ie=s(),ce=[1e4,2e4,-1],pe=[10,20,50,-1];let W=s(0),q=s(0),v=s([]),Y=s([]),d=s(-1),Z=s(0),o=s(),y=s(!1),m=s(!1),M=!1,I=s(0),C;const S=new Set;let O=s([]),$=s(!1),c=s(0),R=s(!0);tt(()=>(fetch(`${e(L)}/sentences.json`).then(t=>t.ok&&t.json()).then(t=>{t&&(a(v,t.sentences),a(Y,t.korean))}),window.addEventListener("keydown",ve),()=>window.removeEventListener("keydown",ve))),at(()=>{var t;(t=e(o))==null||t.pause(),clearInterval(C)});function ve(t){e($)||(["Space","ArrowRight"].includes(t.code)?(t.preventDefault(),E()):t.code==="ArrowLeft"&&e(O).length>1&&(t.preventDefault(),e(O).pop(),B(e(O).at(-1),!1,"eng")))}function ye(){const t=e(x)<0?e(v).length:Math.min(e(x),e(v).length);if(S.size===t)return-1;let r;do r=Math.floor(Math.random()*t);while(S.has(r));return r}S.size===(e(x)<0?e(v).length:Math.min(e(x),e(v).length))&&a($,!0);async function B(t,r=!0,l="kor"){if(!(t<0||t>=e(v).length)){r&&qe(Z),a(d,t),S.add(t),r&&e(O).push(t),await Xe(),e(o).pause(),me(o,e(o).src=`${l==="kor"?e(le):e(oe)}/${String(t+1).padStart(2,"0")}.mp3`);try{await e(o).play(),a(y,!0)}catch{M=!0}}}function $e(){e(o)&&me(o,e(o).onended=()=>{if(a(y,!1),M){M=!1,E();return}if(e(w)>=0&&S.size<e(v).length){de();return}S.size===e(v).length&&a($,!0)})}function de(){a(m,!0),a(I,Math.ceil(e(w)/1e3)),C=setInterval(()=>{We(I,-1)<=0&&(clearInterval(C),a(m,!1),e(y)?M=!0:E())},1e3)}function E(){e(o).pause(),clearInterval(C),a(y,a(m,M=!1)),a(I,0);const t=ye();if(t===-1){a($,!0);return}B(t,!0,"kor")}const we=(t,r)=>r===1?"_".repeat(t.length):r===2?t[0]+"_".repeat(t.length-1):t,Ie=t=>e(c)===4?t:e(c)===3?t.split(" ").map((r,l)=>l%2?"_".repeat(r.length):r).join(" "):e(c)>0?t.split(" ").map(r=>we(r,e(c))).join(" "):"",ee=()=>{e(o).pause(),clearInterval(C),a(y,a(m,M=!1)),a(d,-1),a(Z,a(I,0)),S.clear(),a(O,[]),a($,!1)},Se=()=>e(y)||e(m)||e($)?ee():E(),Ee=()=>a(c,(e(c)+1)%5),Ae=()=>a(R,!e(R)),De=()=>{a(q,(e(q)+1)%pe.length),ee()},Le=()=>{a(W,(e(W)+1)%ce.length),e(m)&&(clearInterval(C),a(m,!1),a(I,0),de())},fe=t=>B(t,!1,"eng");function Me(t){switch(t.detail.id){case"start":Se();break;case"count":De();break;case"hint":Ee();break;case"kor":Ae();break;case"gap":Le();break}}i(()=>ne(),()=>{a(J,ne().params.id)}),i(()=>e(J),()=>{a(L,`${rt}/assets/sentence/${e(J)}`)}),i(()=>e(L),()=>{a(oe,`${e(L)}/audio`)}),i(()=>e(L),()=>{a(le,`${e(L)}/audiok`)}),i(()=>e(W),()=>{a(w,ce[e(W)])}),i(()=>e(q),()=>{a(x,pe[e(q)])}),i(()=>e(o),()=>{e(o)&&$e()}),i(()=>e(x),()=>{a(P,e(x)<0?"전체":e(x)+"개")}),i(()=>(e(y),e(m)),()=>{a(U,e(y)||e(m))}),i(()=>e(w),()=>{a(Q,e(w)<0?"∞":`${e(w)/1e3}s`)}),i(()=>e(c),()=>{a(V,`H${e(c)}`)}),i(()=>(e(U),e(P),e(V),e(c),e(R),e(Q)),()=>{a(ie,[{id:"start",icon:e(U)?"⏹":"▶"},{id:"count",text:`출제:${e(P)}`},{id:"hint",text:e(V),active:e(c)>0},{id:"kor",text:e(R)?"가":"한"},{id:"gap",text:e(Q)}])}),Te(),Ye();var ue=ut(),te=re(ue),ge=g(te);{var Ce=t=>{var r=vt(),l=re(r),N=g(l),j=g(N,!0);_(N);var X=u(N,2);{var A=n=>{var p=ot(),D=g(p,!0);_(p),T(()=>z(D,e(I))),h(n,p)};K(X,n=>{e(w)>=0&&e(I)>0&&n(A)})}var F=u(X,2);{var G=n=>{var p=pt(),D=re(p);{var Ke=f=>{var b=lt(),se=g(b,!0);_(b),T(()=>z(se,e(Y)[e(d)])),h(f,b)};K(D,f=>{e(R)&&f(Ke)})}var Re=u(D,2);{var Be=f=>{var b=it(),se=g(b,!0);_(b),T(Ge=>z(se,Ge),[()=>Ie(e(v)[e(d)])],Fe),h(f,b)},Ne=f=>{var b=ct();h(f,b)};K(Re,f=>{e(c)>0?f(Be):f(Ne,!1)})}h(n,p)};K(F,n=>{e(d)!==-1&&n(G)})}_(l);var ae=u(l,2);T(()=>{Qe(l,1,`sentence-box ${e(U)?"playing":""}`,"svelte-s4lrgb"),z(j,e(d)===-1?"Ready":`#${e(Z)}`)}),H("click",l,function(...n){var p;(p=e(d)===-1?E:()=>B(e(d),!1,"eng"))==null||p.apply(this,n)}),H("keydown",l,n=>["Enter"," "].includes(n.key)&&(n.preventDefault(),e(d)===-1?E():B(e(d),!1,"eng"))),H("click",ae,E),h(t,r)};K(ge,t=>{e($)||t(Ce)})}var Oe=u(ge,2);{var je=t=>{var r=ft(),l=u(g(r),2);Je(l,1,()=>e(O),Pe,(N,j,X)=>{var A=dt(),F=g(A);F.textContent=`${X+1}.`;var G=u(F),ae=g(G,!0);_(G);var n=u(G),p=g(n,!0);_(n),_(A),T(()=>{z(ae,e(v)[e(j)]),z(p,e(Y)[e(j)])}),H("click",A,()=>fe(e(j))),H("keydown",A,D=>["Enter"," "].includes(D.key)&&(D.preventDefault(),fe(e(j)))),h(N,A)}),_(r),h(t,r)};K(Oe,t=>{e($)&&t(je)})}_(te);var _e=u(te,2);nt(_e,{get buttons(){return e(ie)},$$events:{click:Me}});var ze=u(_e,2);Ve(ze,t=>a(o,t),()=>e(o)),h(be,ue),Ue(),xe()}export{At as component};
