import{t as N,e as p,a as B,s as m}from"../chunks/4zatZMyn.js";import"../chunks/CuG-qJQg.js";import{a9 as pe,aa as J,ab as me,f as fe,t as M,ac as _e,s as c,c as o,g as e,a as n,l as s,r as a,ad as he,m as L}from"../chunks/Dyt7jpIe.js";import{i as Q}from"../chunks/js5uGENf.js";import{e as ge,i as ke}from"../chunks/D_BNwrMf.js";import{s as U}from"../chunks/DKvFlRHg.js";import{s as be}from"../chunks/aPhAocpD.js";import{s as W}from"../chunks/DwwtOsHy.js";import{b as $e}from"../chunks/DNHbLls4.js";import{i as ye}from"../chunks/DDVUy9QN.js";import{s as xe,a as we}from"../chunks/BMHBtBG6.js";import{o as Se,a as Ee}from"../chunks/_OyF5GcO.js";import{p as Oe}from"../chunks/Vt7IgUII.js";import{b as Fe}from"../chunks/B3GUe6n2.js";var ze=N('<div class="photo svelte-1usks4h"><div class="label svelte-1usks4h"> </div> <img class="svelte-1usks4h"></div>'),Ie=N('<div class="kor svelte-1usks4h"> </div>'),je=N('<div><div class="speaker svelte-1usks4h"> </div> <div class="text"> </div> <!></div>'),Ae=N('<div class="wrap svelte-1usks4h"><div class="main svelte-1usks4h"><!> <div class="dialogue svelte-1usks4h"></div></div> <div class="ctl svelte-1usks4h"><button class="svelte-1usks4h"> </button> <button class="svelte-1usks4h"> </button> <button class="svelte-1usks4h"> </button> <button class="svelte-1usks4h">크기</button> <button class="svelte-1usks4h"> </button></div></div> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function Le(X,Y){pe(Y,!1);const[Z,ee]=xe(),R=()=>we(Oe,"$page",Z),y=n(),g=n();let d=n([]),x=n({}),v=n(-1),f=n(!1),_=n("none"),w=n("1.2em"),S=n(!0),E=n(!0),u=n();Se(async()=>{if(!e(y))return;const t=await fetch(`${e(g)}/dialogue.json`);if(!t.ok)return;const i=await t.json();s(x,i.persons),s(d,i.conversation.map((l,r)=>({...l,file:`${e(g)}/audio/${String(r+1).padStart(2,"0")}.mp3`})))}),Ee(()=>{var t;return(t=e(u))==null?void 0:t.pause()});async function k(t,i=!0){var l,r;if(t<0||t>=e(d).length){s(f,!1);return}s(v,t),await he(),(l=document.getElementById(`segment-${t}`))==null||l.scrollIntoView({behavior:"smooth",block:"center"}),e(u).pause(),L(u,e(u).src=e(d)[t].file),L(u,e(u).muted=!!((r=e(x)[e(d)[t].speaker])!=null&&r.hideEnglish));try{await e(u).play()}catch{s(f,!1);return}s(f,!0)}function te(){e(_)==="segment"?k(e(v),!1):e(v)<e(d).length-1?k(e(v)+1):e(_)==="all"?k(0):s(f,!1)}function se(){e(f)?(e(u).pause(),s(f,!1)):e(v)===-1?k(0):k(e(v),!1)}function ae(){s(_,e(_)==="none"?"all":e(_)==="all"?"segment":"none")}function re(t){t.target.src=`${e(g)}/ready.webp`}J(()=>R(),()=>{var t;s(y,((t=R().url.pathname.match(/\/dialogue\/([^\/]+)/))==null?void 0:t[1])||"")}),J(()=>e(y),()=>{s(g,`${Fe}/assets/dialogue/${e(y)}`)}),me(),ye();var T=Ae(),P=fe(T),D=o(P),V=o(D);{var oe=t=>{var i=ze(),l=o(i),r=o(l,!0);a(l);var b=c(l,2);a(i),M(()=>{var I,h,j;m(r,((h=e(x)[(I=e(d)[e(v)])==null?void 0:I.speaker])==null?void 0:h.name)||""),U(b,"src",(j=e(d)[e(v)])!=null&&j.speaker?`${e(g)}/${e(d)[e(v)].speaker}.webp`:`${e(g)}/ready.webp`)}),p("error",b,re),B(t,i)};Q(V,t=>{e(E)&&t(oe)})}var q=c(V,2);ge(q,5,()=>e(d),ke,(t,i,l)=>{var r=je();U(r,"id",`segment-${l}`);var b=o(r),I=o(b);a(b);var h=c(b,2),j=o(h,!0);a(h);var ue=c(h,2);{var ce=$=>{var A=Ie(),de=o(A,!0);a(A),M(()=>{W(A,`font-size:${e(w)??""}`),m(de,e(i).korean)}),B($,A)};Q(ue,$=>{e(S)&&$(ce)})}a(r),M(()=>{var $;be(r,1,`seg ${l===e(v)?"active":""}`,"svelte-1usks4h"),m(I,`${(($=e(x)[e(i).speaker])==null?void 0:$.name)??""}:`),W(h,`font-size:${e(w)??""}`),m(j,e(i).text)}),p("click",r,()=>k(l)),B(t,r)}),a(q),a(D);var C=c(D,2),O=o(C),le=o(O,!0);a(O);var F=c(O,2),ie=o(F);a(F);var z=c(F,2),ne=o(z,!0);a(z);var G=c(z,2),K=c(G,2),ve=o(K,!0);a(K),a(C),a(P);var H=c(P,2);$e(H,t=>s(u,t),()=>e(u)),M(()=>{m(le,e(f)?"⏸":"▶"),m(ie,`반복:${e(_)==="none"?"없음":e(_)==="all"?"전체":"구간"}`),m(ne,e(S)?"한글 ON":"한글 OFF"),m(ve,e(E)?"사진 ON":"사진 OFF")}),p("click",O,se),p("click",F,ae),p("click",z,()=>s(S,!e(S))),p("click",G,()=>s(w,e(w)==="1.2em"?"2em":"1.2em")),p("click",K,()=>s(E,!e(E))),p("ended",H,te),B(X,T),_e(),ee()}export{Le as component};
