import{t as d,e as g,a as f,s as h,c as Me}from"../chunks/4zatZMyn.js";import"../chunks/CuG-qJQg.js";import{a9 as Re,aa as Y,ab as ze,f as Z,t as $,ac as Le,a as l,s as c,c as v,g as e,l as t,ae as je,ad as Ce,m as ie,r as o,af as Ne,R as Te}from"../chunks/Dyt7jpIe.js";import{i as j}from"../chunks/js5uGENf.js";import{e as ve,i as ce}from"../chunks/D_BNwrMf.js";import{s as fe}from"../chunks/aPhAocpD.js";import{b as Be}from"../chunks/DNHbLls4.js";import{i as Ge}from"../chunks/DDVUy9QN.js";import{s as Ke,a as Oe}from"../chunks/BMHBtBG6.js";import{o as We,a as Xe}from"../chunks/_OyF5GcO.js";import{p as Fe}from"../chunks/nomUDxwQ.js";import{b as He}from"../chunks/EVmmLd5B.js";var Je=d('<div class="remain-big svelte-bmqalv"> </div>'),Pe=d('<p class="eng svelte-bmqalv"> </p>'),Qe=d('<p class="kor svelte-bmqalv"> </p>'),Ue=d('<p class="placeholder svelte-bmqalv">•••</p>'),Ve=d('<div role="button" tabindex="0"><div class="order-big svelte-bmqalv"> </div> <!> <!></div> <button class="next-btn svelte-bmqalv">NEXT ⏭</button>',1),Ye=d('<div class="result-item svelte-bmqalv" role="button" tabindex="0"><span class="num svelte-bmqalv"></span> <span class="eng txt svelte-bmqalv"> </span> <span class="kor txt svelte-bmqalv"> </span></div>'),Ze=d('<div class="result-list svelte-bmqalv"><h2 class="svelte-bmqalv">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),ea=d("<button> </button>"),aa=d('<main class="wrapper svelte-bmqalv"><!> <!></main> <div class="controls svelte-bmqalv"><button class="svelte-bmqalv">⏹ 멈춤</button> <button class="svelte-bmqalv"> </button> <div class="gap-group svelte-bmqalv"></div></div> <audio playsinline="" preload="auto" class="svelte-bmqalv"></audio>',1);function ua(de,pe){Re(pe,!1);const[ue,me]=Ke(),ee=()=>Oe(Fe,"$page",ue),X=l(),F=l();let p=l([]),H=l([]),u=l(-1),J=l(0),r=l(),E=l(!1),w=l(!1),S=!1;const ae=[1e4,2e4,-1];let C=l(ae[0]),y=l(0),I;const D=new Set;let k=l([]),A=l(!1);We(async()=>{const a=await fetch(`${e(F)}/sentences.json`);if(a.ok){const s=await a.json();t(p,s.sentences),t(H,s.korean)}typeof window<"u"&&window.addEventListener("keydown",te)}),Xe(()=>{var a;(a=e(r))==null||a.pause(),clearInterval(I),typeof window<"u"&&window.removeEventListener("keydown",te)});function te(a){e(A)||(["Space","ArrowRight"].includes(a.code)?(a.preventDefault(),T()):a.code==="ArrowLeft"&&e(k).length>1&&(a.preventDefault(),e(k).pop(),N(e(k)[e(k).length-1],!1)))}function _e(){if(D.size===e(p).length)return-1;let a;do a=Math.floor(Math.random()*e(p).length);while(D.has(a));return a}async function N(a,s=!0){if(!(a<0||a>=e(p).length)){s&&je(J),t(u,a),D.add(a),s&&e(k).push(a),await Ce(),e(r).pause(),ie(r,e(r).src=`${e(F)}/audio/${String(a+1).padStart(2,"0")}.mp3`);try{await e(r).play(),t(E,!0)}catch{S=!0}}}function be(){e(r)&&ie(r,e(r).onended=()=>{if(t(E,!1),S){S=!1,T();return}if(e(C)>=0&&D.size<e(p).length){ge();return}D.size===e(p).length&&t(A,!0)})}function ge(){t(w,!0),t(y,Math.ceil(e(C)/1e3)),I=setInterval(()=>{Ne(y,-1)<=0&&(clearInterval(I),t(w,!1),e(E)?S=!0:T())},1e3)}function T(){e(r).pause(),clearInterval(I),t(E,t(w,S=!1)),t(y,0);const a=_e();if(a===-1){t(A,!0);return}N(a)}function se(){e(u)===-1?T():N(e(u),!1)}function he(){e(r).pause(),clearInterval(I),t(E,t(w,S=!1)),t(u,-1),t(J,0),t(y,0),D.clear(),t(k,[]),t(A,!1)}let x=l("none");function we(){t(x,e(x)==="none"?"eng":e(x)==="eng"?"kor":"none")}function ye(a){t(C,a),e(w)&&(clearInterval(I),t(w,!1),t(y,0))}Y(()=>ee(),()=>{t(X,ee().params.id)}),Y(()=>e(X),()=>{t(F,`${He}/assets/sentence/${e(X)}`)}),Y(()=>e(r),()=>{e(r)&&be()}),ze(),Ge();var re=aa(),P=Z(re),ne=v(P);{var ke=a=>{var s=Ve(),n=Z(s),m=v(n),_=v(m,!0);o(m);var M=c(m,2);{var q=i=>{var b=Je(),R=v(b,!0);o(b),$(()=>h(R,e(y))),f(i,b)};j(M,i=>{e(C)>=0&&e(y)>0&&i(q)})}var W=c(M,2);{var B=i=>{var b=Me(),R=Z(b);{var Se=z=>{var G=Pe(),V=v(G,!0);o(G),$(()=>h(V,e(p)[e(u)])),f(z,G)},Ie=(z,G)=>{{var V=L=>{var K=Qe(),Ae=v(K,!0);o(K),$(()=>h(Ae,e(H)[e(u)])),f(L,K)},De=L=>{var K=Ue();f(L,K)};j(z,L=>{e(x)==="kor"?L(V):L(De,!1)},G)}};j(R,z=>{e(x)==="eng"?z(Se):z(Ie,!1)})}f(i,b)};j(W,i=>{e(u)!==-1&&i(B)})}o(n);var U=c(n,2);$(()=>{fe(n,1,`sentence-box ${e(E)||e(w)?"playing":""}`,"svelte-bmqalv"),h(_,e(u)===-1?"Ready":`#${e(J)}`)}),g("click",n,se),g("keydown",n,i=>{["Enter"," "].includes(i.key)&&(i.preventDefault(),se())}),g("click",U,T),f(a,s)};j(ne,a=>{e(A)||a(ke)})}var xe=c(ne,2);{var qe=a=>{var s=Ze(),n=c(v(s),2);ve(n,1,()=>e(k),ce,(m,_,M)=>{var q=Ye(),W=v(q);W.textContent=`${M+1}.`;var B=c(W,2),U=v(B,!0);o(B);var i=c(B,2),b=v(i,!0);o(i),o(q),$(()=>{h(U,e(p)[e(_)]),h(b,e(H)[e(_)])}),g("click",q,()=>N(e(_),!1)),g("keydown",q,R=>{["Enter"," "].includes(R.key)&&(R.preventDefault(),N(e(_),!1))}),f(m,q)}),o(s),f(a,s)};j(xe,a=>{e(A)&&a(qe)})}o(P);var Q=c(P,2),le=v(Q),O=c(le,2),$e=v(O,!0);o(O);var oe=c(O,2);ve(oe,5,()=>ae,ce,(a,s)=>{var n=ea();let m;var _=v(n,!0);o(n),$(M=>{m=fe(n,1,"svelte-bmqalv",null,m,M),h(_,e(s)<0?"시간 제한 없음":`${e(s)/1e3}s`)},[()=>({selected:e(C)===e(s)})],Te),g("click",n,()=>ye(e(s))),f(a,n)}),o(oe),o(Q);var Ee=c(Q,2);Be(Ee,a=>t(r,a),()=>e(r)),$(()=>h($e,e(x)==="none"?"표시:없음":e(x)==="eng"?"표시:영어":"표시:한글")),g("click",le,he),g("click",O,we),f(de,re),Le(),me()}export{ua as component};
