import"../chunks/NZTpNUN0.js";import{i as oe}from"../chunks/tEBiHiVF.js";import{q as le,D as B,F as ne,u as E,G as de,K as C,v as S,w as ve,z as _,g as e,s as t,m as s,P as pe,M as G,y as m,x as v,A,C as z}from"../chunks/CwV636Gc.js";import{i as R}from"../chunks/BpFCBlOt.js";import{e as ce,i as me,s as fe}from"../chunks/lfAz8Y32.js";import{s as T}from"../chunks/BGfsMArk.js";import{s as V}from"../chunks/Bk8RznBR.js";import{b as ue}from"../chunks/S5asknXf.js";import{s as ge,a as _e}from"../chunks/C3Q7PnuQ.js";import{o as he,a as $e}from"../chunks/Dcbe9JOZ.js";import{p as ke}from"../chunks/B8zoCcxA.js";import{b as be}from"../chunks/3tUvlbEd.js";import{C as ye}from"../chunks/D51qih5w.js";var xe=E('<div class="photo svelte-1d2haii"><div class="label svelte-1d2haii"> </div> <img class="svelte-1d2haii"></div>'),we=E('<div class="kor svelte-1d2haii"> </div>'),Se=E('<div><div class="speaker svelte-1d2haii"> </div> <div class="text"> </div> <!></div>'),ze=E('<div class="wrap svelte-1d2haii"><div class="main svelte-1d2haii"><!> <div class="dialogue svelte-1d2haii"></div></div></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function qe(H,J){le(J,!1);const[L,Q]=ge(),I=()=>_e(ke,"$page",L),k=s(),f=s(),M=s();let n=s([]),b=s({}),i=s(-1),p=s(!1),c=s("none"),y=s("1.2em"),h=s(!0),$=s(!0),o=s();he(async()=>{if(!e(k))return;const a=await fetch(`${e(f)}/dialogue.json`);if(!a.ok)return;const r=await a.json();t(b,r.persons),t(n,r.conversation.map((d,l)=>({...d,file:`${e(f)}/audio/${String(l+1).padStart(2,"0")}.mp3`})))}),$e(()=>e(o)?.pause());async function u(a,r=!0){if(a<0||a>=e(n).length){t(p,!1);return}t(i,a),await pe(),document.getElementById(`segment-${a}`)?.scrollIntoView({behavior:"smooth",block:"center"}),e(o).pause(),G(o,e(o).src=e(n)[a].file),G(o,e(o).muted=!!e(b)[e(n)[a].speaker]?.hideEnglish);try{await e(o).play()}catch{t(p,!1);return}t(p,!0)}function U(){e(c)==="segment"?u(e(i),!1):e(i)<e(n).length-1?u(e(i)+1):e(c)==="all"?u(0):t(p,!1)}function W(){e(p)?(e(o).pause(),t(p,!1)):e(i)===-1?u(0):u(e(i),!1)}function X(){t(c,e(c)==="none"?"all":e(c)==="all"?"segment":"none")}function Y(a){a.target.src=`${e(f)}/ready.webp`}function Z(a){switch(a.detail.id){case"play":W();break;case"repeat":X();break;case"kor":t(h,!e(h));break;case"size":t(y,e(y)==="1.2em"?"2em":"1.2em");break;case"photo":t($,!e($));break}}B(()=>I(),()=>{t(k,I().url.pathname.match(/\/dialogue\/([^\/]+)/)?.[1]||"")}),B(()=>e(k),()=>{t(f,`${be}/assets/dialogue/${e(k)}`)}),B(()=>(e(p),e(c),e(h),e($)),()=>{t(M,[{id:"play",icon:e(p)?"⏸":"▶"},{id:"repeat",text:`반복:${e(c)==="none"?"없음":e(c)==="all"?"전체":"구간"}`},{id:"kor",text:e(h)?"한글 ON":"한글 OFF"},{id:"size",text:"크기"},{id:"photo",text:e($)?"사진 ON":"사진 OFF"}])}),ne(),oe();var P=ze(),F=de(P),j=m(F),D=m(j);{var ee=a=>{var r=xe(),d=m(r),l=m(d,!0);v(d);var g=_(d,2);v(r),A(()=>{z(l,e(b)[e(n)[e(i)]?.speaker]?.name||""),T(g,"src",e(n)[e(i)]?.speaker?`${e(f)}/${e(n)[e(i)].speaker}.webp`:`${e(f)}/ready.webp`)}),C("error",g,Y),S(a,r)};R(D,a=>{e($)&&a(ee)})}var K=_(D,2);ce(K,5,()=>e(n),me,(a,r,d)=>{var l=Se();T(l,"id",`segment-${d}`);var g=m(l),ae=m(g);v(g);var x=_(g,2),te=m(x,!0);v(x);var se=_(x,2);{var re=O=>{var w=we(),ie=m(w,!0);v(w),A(()=>{V(w,`font-size:${e(y)??""}`),z(ie,e(r).korean)}),S(O,w)};R(se,O=>{e(h)&&O(re)})}v(l),A(()=>{fe(l,1,`seg ${d===e(i)?"active":""}`,"svelte-1d2haii"),z(ae,`${e(b)[e(r).speaker]?.name??""}:`),V(x,`font-size:${e(y)??""}`),z(te,e(r).text)}),C("click",l,()=>u(d)),S(a,l)}),v(K),v(j),v(F);var N=_(F,2);ye(N,{get buttons(){return e(M)},$$events:{click:Z}});var q=_(N,2);ue(q,a=>t(o,a),()=>e(o)),C("ended",q,U),S(H,P),ve(),Q()}export{qe as component};
