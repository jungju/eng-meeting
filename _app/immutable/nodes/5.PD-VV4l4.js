import{t as $,a as y,s as K,e as H}from"../chunks/CMAwb4th.js";import"../chunks/CthApk8F.js";import{a6 as He,g as e,e as a,a7 as l,a8 as Te,f as se,a9 as Ue,a as r,s as _,ac as We,ab as qe,aa as Xe,m as _e,c as m,r as k,t as T,O as Fe}from"../chunks/DnBkWd9o.js";import{i as M}from"../chunks/3lh4epU4.js";import{e as Je,i as Pe}from"../chunks/D7qEBDdj.js";import{s as Qe}from"../chunks/DH_McDNf.js";import{b as Ve}from"../chunks/M8wP0stW.js";import{i as Ye}from"../chunks/RqZXrTMm.js";import{s as Ze,a as et}from"../chunks/CKqP-jYq.js";import{o as tt,a as at}from"../chunks/xvpwIJTT.js";import{p as rt}from"../chunks/D4YsFr_v.js";import{b as st}from"../chunks/B3zWY6Pc.js";import{C as nt}from"../chunks/My-eeozF.js";var ot=$('<div class="remain-big svelte-1h60khx"> </div>'),it=$('<p class="kor svelte-1h60khx"> </p>'),lt=$('<p class="eng svelte-1h60khx"> </p>'),ct=$('<p class="placeholder svelte-1h60khx">•••</p>'),pt=$("<!> <!>",1),vt=$('<div role="button" tabindex="0"><div class="order-big svelte-1h60khx"> </div> <!> <!></div> <button class="next-btn svelte-1h60khx">NEXT ⏭</button>',1),dt=$('<div class="result-item svelte-1h60khx" role="button" tabindex="0"><span class="num svelte-1h60khx"></span><span class="eng txt svelte-1h60khx"> </span><span class="kor txt svelte-1h60khx"> </span></div>'),ft=$('<div class="result-list svelte-1h60khx"><h2 class="svelte-1h60khx">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),ut=$('<main class="wrapper svelte-1h60khx"><!> <!></main> <!> <audio playsinline="" preload="auto" class="svelte-1h60khx"></audio>',1);function Lt(me,ke){He(ke,!1);const[xe,be]=Ze(),ne=()=>et(rt,"$page",xe),J=r(),D=r(),oe=r(),ie=r(),w=r(),d=r(),P=r(),U=r(),Q=r(),V=r(),le=r(),ce=[1e4,2e4,3e4,-1],pe=[10,20,50,-1];let W=r(0),q=r(0),f=r([]),Y=r([]),u=r(-1),Z=r(0),o=r(),I=r(!1),h=r(!1),C=!1,S=r(0),E;const c=new Set;let O=r([]),x=r(!1),p=r(0),R=r(!0);tt(()=>(fetch(`${e(D)}/sentences.json`).then(t=>t.ok&&t.json()).then(t=>{t&&(a(f,t.sentences),a(Y,t.korean))}),window.addEventListener("keydown",ve),()=>window.removeEventListener("keydown",ve))),at(()=>{var t;(t=e(o))==null||t.pause(),clearInterval(E)});function ve(t){e(x)||(["Space","ArrowRight"].includes(t.code)?(t.preventDefault(),L()):t.code==="ArrowLeft"&&e(O).length>1&&(t.preventDefault(),e(O).pop(),B(e(O).at(-1),!1,"eng")))}function ye(){if(e(d)>=0&&c.size>=e(d)||c.size===e(f).length)return-1;let t;do t=Math.floor(Math.random()*e(f).length);while(c.has(t));return t}(e(d)<0?c.size===e(f).length:c.size===e(d))&&a(x,!0);async function B(t,s=!0,i="kor"){if(!(t<0||t>=e(f).length)){s&&qe(Z),a(u,t),c.add(t),s&&e(O).push(t),await Xe(),e(o).pause(),_e(o,e(o).src=`${i==="kor"?e(ie):e(oe)}/${String(t+1).padStart(2,"0")}.mp3`);try{await e(o).play(),a(I,!0)}catch{C=!0}}}function $e(){if(!e(o))return;_e(o,e(o).onended=()=>{if(a(I,!1),C){C=!1,L();return}if(e(w)>=0&&c.size<e(f).length){de();return}c.size===e(f).length&&a(x,!0)}),(e(d)<0?c.size===e(f).length:c.size===e(d))&&a(x,!0)}function de(){e(w)<0||(e(h)&&clearInterval(E),a(h,!0),a(S,Math.ceil(e(w)/1e3)),E=setInterval(()=>{We(S,-1)<=0&&(clearInterval(E),a(h,!1),e(I)?C=!0:L())},1e3))}function L(){e(o).pause(),clearInterval(E),a(I,a(h,C=!1)),a(S,0);const t=ye();if(t===-1){a(x,!0);return}B(t,!0,"kor")}const we=(t,s)=>s===1?"_".repeat(t.length):s===2?t[0]+"_".repeat(t.length-1):t,Ie=t=>e(p)===4?t:e(p)===3?t.split(" ").map((s,i)=>i%2?"_".repeat(s.length):s).join(" "):e(p)>0?t.split(" ").map(s=>we(s,e(p))).join(" "):"",ee=()=>{e(o).pause(),clearInterval(E),a(I,a(h,C=!1)),a(u,-1),a(Z,a(S,0)),c.clear(),a(O,[]),a(x,!1)},Se=()=>e(I)||e(h)||e(x)?ee():L(),Ee=()=>a(p,(e(p)+1)%5),Le=()=>a(R,!e(R)),ze=()=>{a(q,(e(q)+1)%pe.length),ee()},Ae=()=>{a(W,(e(W)+1)%ce.length),e(h)&&(clearInterval(E),a(h,!1),a(S,0),de())},fe=t=>B(t,!1,"eng");function De(t){switch(t.detail.id){case"start":Se();break;case"count":ze();break;case"hint":Ee();break;case"kor":Le();break;case"gap":Ae();break}}l(()=>ne(),()=>{a(J,ne().params.id)}),l(()=>e(J),()=>{a(D,`${st}/assets/sentence/${e(J)}`)}),l(()=>e(D),()=>{a(oe,`${e(D)}/audio`)}),l(()=>e(D),()=>{a(ie,`${e(D)}/audiok`)}),l(()=>e(W),()=>{a(w,ce[e(W)])}),l(()=>e(q),()=>{a(d,pe[e(q)])}),l(()=>e(o),()=>{e(o)&&$e()}),l(()=>e(d),()=>{a(P,e(d)<0?"전체":e(d)+"개")}),l(()=>(e(I),e(h)),()=>{a(U,e(I)||e(h))}),l(()=>e(w),()=>{a(Q,e(w)<0?"∞":`${e(w)/1e3}s`)}),l(()=>e(p),()=>{a(V,`H${e(p)}`)}),l(()=>(e(U),e(P),e(V),e(p),e(R),e(Q)),()=>{a(le,[{id:"start",icon:e(U)?"⏹":"▶"},{id:"count",text:`출제:${e(P)}`},{id:"hint",text:e(V),active:e(p)>0},{id:"kor",text:e(R)?"가":"한"},{id:"gap",text:e(Q)}])}),Te(),Ye();var ue=ut(),te=se(ue),he=m(te);{var Ce=t=>{var s=vt(),i=se(s),N=m(i),j=m(N,!0);k(N);var X=_(N,2);{var z=n=>{var v=ot(),A=m(v,!0);k(v),T(()=>K(A,e(S))),y(n,v)};M(X,n=>{e(w)>=0&&e(S)>0&&n(z)})}var F=_(X,2);{var G=n=>{var v=pt(),A=se(v);{var Me=g=>{var b=it(),re=m(b,!0);k(b),T(()=>K(re,e(Y)[e(u)])),y(g,b)};M(A,g=>{e(R)&&g(Me)})}var Re=_(A,2);{var Be=g=>{var b=lt(),re=m(b,!0);k(b),T(Ge=>K(re,Ge),[()=>Ie(e(f)[e(u)])],Fe),y(g,b)},Ne=g=>{var b=ct();y(g,b)};M(Re,g=>{e(p)>0?g(Be):g(Ne,!1)})}y(n,v)};M(F,n=>{e(u)!==-1&&n(G)})}k(i);var ae=_(i,2);T(()=>{Qe(i,1,`sentence-box ${e(U)?"playing":""}`,"svelte-1h60khx"),K(j,e(u)===-1?"Ready":`#${e(Z)}`)}),H("click",i,function(...n){var v;(v=e(u)===-1?L:()=>B(e(u),!1,"eng"))==null||v.apply(this,n)}),H("keydown",i,n=>["Enter"," "].includes(n.key)&&(n.preventDefault(),e(u)===-1?L():B(e(u),!1,"eng"))),H("click",ae,L),y(t,s)};M(he,t=>{e(x)||t(Ce)})}var Oe=_(he,2);{var je=t=>{var s=ft(),i=_(m(s),2);Je(i,1,()=>e(O),Pe,(N,j,X)=>{var z=dt(),F=m(z);F.textContent=`${X+1}.`;var G=_(F),ae=m(G,!0);k(G);var n=_(G),v=m(n,!0);k(n),k(z),T(()=>{K(ae,e(f)[e(j)]),K(v,e(Y)[e(j)])}),H("click",z,()=>fe(e(j))),H("keydown",z,A=>["Enter"," "].includes(A.key)&&(A.preventDefault(),fe(e(j)))),y(N,z)}),k(s),y(t,s)};M(Oe,t=>{e(x)&&t(je)})}k(te);var ge=_(te,2);nt(ge,{get buttons(){return e(le)},$$events:{click:De}});var Ke=_(ge,2);Ve(Ke,t=>a(o,t),()=>e(o)),y(me,ue),Ue(),be()}export{Lt as component};
