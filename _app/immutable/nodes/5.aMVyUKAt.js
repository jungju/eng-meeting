import"../chunks/NZTpNUN0.js";import{i as Ce}from"../chunks/tEBiHiVF.js";import{q as De,D as L,F as Ae,u as g,G as ee,v,w as Le,s as a,g as e,z as c,m as s,I as Me,P as ze,M as le,y as i,x as l,Q as Be,A as O,C as M,K as T,J as Re}from"../chunks/CwV636Gc.js";import{i as z}from"../chunks/BpFCBlOt.js";import{s as je,e as Ge,i as Ke}from"../chunks/lfAz8Y32.js";import{b as Ne}from"../chunks/S5asknXf.js";import{s as Oe,a as Te}from"../chunks/C3Q7PnuQ.js";import{o as qe,a as Fe}from"../chunks/Dcbe9JOZ.js";import{p as Je}from"../chunks/B8zoCcxA.js";import{b as Pe}from"../chunks/3tUvlbEd.js";import{C as Qe}from"../chunks/D51qih5w.js";var We=g('<div class="remain-big svelte-hathbp"> </div>'),Xe=g('<p class="eng svelte-hathbp"> </p>'),He=g('<p class="kor svelte-hathbp"> </p>'),Ue=g('<p class="placeholder svelte-hathbp">•••</p>'),Ve=g('<div role="button" tabindex="0"><div class="order-big svelte-hathbp"> </div> <!> <!></div> <button class="next-btn svelte-hathbp">NEXT ⏭</button>',1),Ye=g('<div class="result-item svelte-hathbp" role="button" tabindex="0"><span class="num svelte-hathbp"></span> <span class="eng txt svelte-hathbp"> </span> <span class="kor txt svelte-hathbp"> </span></div>'),Ze=g('<div class="result-list svelte-hathbp"><h2 class="svelte-hathbp">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),et=g('<main class="wrapper svelte-hathbp"><!> <!></main> <!> <audio playsinline="" preload="auto" class="svelte-hathbp"></audio>',1);function ft(pe,ve){De(ve,!1);const[ce,fe]=Oe(),te=()=>Te(Je,"$page",ce),P=s(),Q=s(),W=s(),X=s(),ae=s();let f=s([]),H=s([]),d=s(-1),U=s(0),n=s(),k=s(!1),m=s(!1),x=!1;const q=[1e4,2e4,-1];let u=s(q[0]),b=s(0),$;const E=new Set;let w=s([]),S=s(!1);qe(async()=>{const t=await fetch(`${e(Q)}/sentences.json`);if(t.ok){const o=await t.json();a(f,o.sentences),a(H,o.korean)}typeof window<"u"&&window.addEventListener("keydown",se)}),Fe(()=>{e(n)?.pause(),clearInterval($),typeof window<"u"&&window.removeEventListener("keydown",se)});function se(t){e(S)||(["Space","ArrowRight"].includes(t.code)?(t.preventDefault(),R()):t.code==="ArrowLeft"&&e(w).length>1&&(t.preventDefault(),e(w).pop(),B(e(w)[e(w).length-1],!1)))}function de(){if(E.size===e(f).length)return-1;let t;do t=Math.floor(Math.random()*e(f).length);while(E.has(t));return t}async function B(t,o=!0){if(!(t<0||t>=e(f).length)){o&&Me(U),a(d,t),E.add(t),o&&e(w).push(t),await ze(),e(n).pause(),le(n,e(n).src=`${e(Q)}/audio/${String(t+1).padStart(2,"0")}.mp3`);try{await e(n).play(),a(k,!0)}catch{x=!0}}}function ue(){e(n)&&le(n,e(n).onended=()=>{if(a(k,!1),x){x=!1,R();return}if(e(u)>=0&&E.size<e(f).length){he();return}E.size===e(f).length&&a(S,!0)})}function he(){a(m,!0),a(b,Math.ceil(e(u)/1e3)),$=setInterval(()=>{Be(b,-1)<=0&&(clearInterval($),a(m,!1),e(k)?x=!0:R())},1e3)}function R(){e(n).pause(),clearInterval($),a(k,a(m,x=!1)),a(b,0);const t=de();if(t===-1){a(S,!0);return}B(t)}function ne(){e(d)===-1?R():B(e(d),!1)}function _e(){e(n).pause(),clearInterval($),a(k,a(m,x=!1)),a(d,-1),a(U,0),a(b,0),E.clear(),a(w,[]),a(S,!1)}let p=s("none");function ge(){a(p,e(p)==="none"?"eng":e(p)==="eng"?"kor":"none")}function me(t){a(u,t),e(m)&&(clearInterval($),a(m,!1),a(b,0))}function be(t){switch(t.detail.id){case"stop":_e();break;case"show":ge();break;case"gap":me(q[(q.indexOf(e(u))+1)%q.length]);break}}L(()=>te(),()=>{a(P,te().params.id)}),L(()=>e(P),()=>{a(Q,`${Pe}/assets/sentence/${e(P)}`)}),L(()=>e(n),()=>{e(n)&&ue()}),L(()=>e(p),()=>{a(W,e(p)==="none"?"표시:없음":e(p)==="eng"?"표시:영어":"표시:한글")}),L(()=>e(u),()=>{a(X,e(u)<0?"무제한":`${e(u)/1e3}s`)}),L(()=>(e(W),e(X)),()=>{a(ae,[{id:"stop",icon:"⏹"},{id:"show",text:e(W)},{id:"gap",text:`간격:${e(X)}`}])}),Ae(),Ce();var re=et(),V=ee(re),oe=i(V);{var we=t=>{var o=Ve(),h=ee(o),j=i(h),I=i(j,!0);l(j);var F=c(j,2);{var y=r=>{var _=We(),C=i(_,!0);l(_),O(()=>M(C,e(b))),v(r,_)};z(F,r=>{e(u)>=0&&e(b)>0&&r(y)})}var J=c(F,2);{var G=r=>{var _=Re(),C=ee(_);{var $e=D=>{var K=Xe(),Z=i(K,!0);l(K),O(()=>M(Z,e(f)[e(d)])),v(D,K)},Ee=(D,K)=>{{var Z=A=>{var N=He(),Ie=i(N,!0);l(N),O(()=>M(Ie,e(H)[e(d)])),v(A,N)},Se=A=>{var N=Ue();v(A,N)};z(D,A=>{e(p)==="kor"?A(Z):A(Se,!1)},K)}};z(C,D=>{e(p)==="eng"?D($e):D(Ee,!1)})}v(r,_)};z(J,r=>{e(d)!==-1&&r(G)})}l(h);var Y=c(h,2);O(()=>{je(h,1,`sentence-box ${e(k)||e(m)?"playing":""}`,"svelte-hathbp"),M(I,e(d)===-1?"Ready":`#${e(U)}`)}),T("click",h,ne),T("keydown",h,r=>{["Enter"," "].includes(r.key)&&(r.preventDefault(),ne())}),T("click",Y,R),v(t,o)};z(oe,t=>{e(S)||t(we)})}var ye=c(oe,2);{var ke=t=>{var o=Ze(),h=c(i(o),2);Ge(h,1,()=>e(w),Ke,(j,I,F)=>{var y=Ye(),J=i(y);J.textContent=`${F+1}.`;var G=c(J,2),Y=i(G,!0);l(G);var r=c(G,2),_=i(r,!0);l(r),l(y),O(()=>{M(Y,e(f)[e(I)]),M(_,e(H)[e(I)])}),T("click",y,()=>B(e(I),!1)),T("keydown",y,C=>{["Enter"," "].includes(C.key)&&(C.preventDefault(),B(e(I),!1))}),v(j,y)}),l(o),v(t,o)};z(ye,t=>{e(S)&&t(ke)})}l(V);var ie=c(V,2);Qe(ie,{get buttons(){return e(ae)},$$events:{click:be,toggle:t=>a(p,t.detail.visible)}});var xe=c(ie,2);Ne(xe,t=>a(n,t),()=>e(n)),v(pe,re),Le(),fe()}export{ft as component};
