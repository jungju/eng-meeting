import{t as _,a as c,s as A,e as G,c as Ce}from"../chunks/CMAwb4th.js";import"../chunks/CthApk8F.js";import{a6 as De,a7 as M,a8 as Le,f as ee,a9 as Ae,e as a,g as e,a as s,s as f,ab as Me,aa as ze,m as le,c as i,r as l,ac as Be,t as K}from"../chunks/DnBkWd9o.js";import{i as z}from"../chunks/3lh4epU4.js";import{e as Re,i as je}from"../chunks/D7qEBDdj.js";import{s as Ne}from"../chunks/DH_McDNf.js";import{b as Oe}from"../chunks/M8wP0stW.js";import{i as Te}from"../chunks/RqZXrTMm.js";import{s as Ge,a as Ke}from"../chunks/CKqP-jYq.js";import{o as We,a as Xe}from"../chunks/xvpwIJTT.js";import{p as qe}from"../chunks/CG-J5PH0.js";import{b as Fe}from"../chunks/CHDfB7Nn.js";import{C as He}from"../chunks/My-eeozF.js";var Je=_('<div class="remain-big svelte-hathbp"> </div>'),Pe=_('<p class="eng svelte-hathbp"> </p>'),Qe=_('<p class="kor svelte-hathbp"> </p>'),Ue=_('<p class="placeholder svelte-hathbp">•••</p>'),Ve=_('<div role="button" tabindex="0"><div class="order-big svelte-hathbp"> </div> <!> <!></div> <button class="next-btn svelte-hathbp">NEXT ⏭</button>',1),Ye=_('<div class="result-item svelte-hathbp" role="button" tabindex="0"><span class="num svelte-hathbp"></span> <span class="eng txt svelte-hathbp"> </span> <span class="kor txt svelte-hathbp"> </span></div>'),Ze=_('<div class="result-list svelte-hathbp"><h2 class="svelte-hathbp">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),et=_('<main class="wrapper svelte-hathbp"><!> <!></main> <!> <audio playsinline="" preload="auto" class="svelte-hathbp"></audio>',1);function ut(pe,ce){De(ce,!1);const[fe,ve]=Ge(),te=()=>Ke(qe,"$page",fe),F=s(),H=s(),J=s(),P=s(),ae=s();let v=s([]),Q=s([]),d=s(-1),U=s(0),r=s(),y=s(!1),g=s(!1),x=!1;const W=[1e4,2e4,-1];let u=s(W[0]),b=s(0),$;const E=new Set;let w=s([]),S=s(!1);We(async()=>{const t=await fetch(`${e(H)}/sentences.json`);if(t.ok){const o=await t.json();a(v,o.sentences),a(Q,o.korean)}typeof window<"u"&&window.addEventListener("keydown",se)}),Xe(()=>{var t;(t=e(r))==null||t.pause(),clearInterval($),typeof window<"u"&&window.removeEventListener("keydown",se)});function se(t){e(S)||(["Space","ArrowRight"].includes(t.code)?(t.preventDefault(),R()):t.code==="ArrowLeft"&&e(w).length>1&&(t.preventDefault(),e(w).pop(),B(e(w)[e(w).length-1],!1)))}function de(){if(E.size===e(v).length)return-1;let t;do t=Math.floor(Math.random()*e(v).length);while(E.has(t));return t}async function B(t,o=!0){if(!(t<0||t>=e(v).length)){o&&Me(U),a(d,t),E.add(t),o&&e(w).push(t),await ze(),e(r).pause(),le(r,e(r).src=`${e(H)}/audio/${String(t+1).padStart(2,"0")}.mp3`);try{await e(r).play(),a(y,!0)}catch{x=!0}}}function ue(){e(r)&&le(r,e(r).onended=()=>{if(a(y,!1),x){x=!1,R();return}if(e(u)>=0&&E.size<e(v).length){he();return}E.size===e(v).length&&a(S,!0)})}function he(){a(g,!0),a(b,Math.ceil(e(u)/1e3)),$=setInterval(()=>{Be(b,-1)<=0&&(clearInterval($),a(g,!1),e(y)?x=!0:R())},1e3)}function R(){e(r).pause(),clearInterval($),a(y,a(g,x=!1)),a(b,0);const t=de();if(t===-1){a(S,!0);return}B(t)}function re(){e(d)===-1?R():B(e(d),!1)}function me(){e(r).pause(),clearInterval($),a(y,a(g,x=!1)),a(d,-1),a(U,0),a(b,0),E.clear(),a(w,[]),a(S,!1)}let p=s("none");function _e(){a(p,e(p)==="none"?"eng":e(p)==="eng"?"kor":"none")}function ge(t){a(u,t),e(g)&&(clearInterval($),a(g,!1),a(b,0))}function be(t){switch(t.detail.id){case"stop":me();break;case"show":_e();break;case"gap":ge(W[(W.indexOf(e(u))+1)%W.length]);break}}M(()=>te(),()=>{a(F,te().params.id)}),M(()=>e(F),()=>{a(H,`${Fe}/assets/sentence/${e(F)}`)}),M(()=>e(r),()=>{e(r)&&ue()}),M(()=>e(p),()=>{a(J,e(p)==="none"?"표시:없음":e(p)==="eng"?"표시:영어":"표시:한글")}),M(()=>e(u),()=>{a(P,e(u)<0?"무제한":`${e(u)/1e3}s`)}),M(()=>(e(J),e(P)),()=>{a(ae,[{id:"stop",icon:"⏹"},{id:"show",text:e(J)},{id:"gap",text:`간격:${e(P)}`}])}),Le(),Te();var ne=et(),V=ee(ne),oe=i(V);{var we=t=>{var o=Ve(),h=ee(o),j=i(h),I=i(j,!0);l(j);var X=f(j,2);{var k=n=>{var m=Je(),C=i(m,!0);l(m),K(()=>A(C,e(b))),c(n,m)};z(X,n=>{e(u)>=0&&e(b)>0&&n(k)})}var q=f(X,2);{var N=n=>{var m=Ce(),C=ee(m);{var $e=D=>{var O=Pe(),Z=i(O,!0);l(O),K(()=>A(Z,e(v)[e(d)])),c(D,O)},Ee=(D,O)=>{{var Z=L=>{var T=Qe(),Ie=i(T,!0);l(T),K(()=>A(Ie,e(Q)[e(d)])),c(L,T)},Se=L=>{var T=Ue();c(L,T)};z(D,L=>{e(p)==="kor"?L(Z):L(Se,!1)},O)}};z(C,D=>{e(p)==="eng"?D($e):D(Ee,!1)})}c(n,m)};z(q,n=>{e(d)!==-1&&n(N)})}l(h);var Y=f(h,2);K(()=>{Ne(h,1,`sentence-box ${e(y)||e(g)?"playing":""}`,"svelte-hathbp"),A(I,e(d)===-1?"Ready":`#${e(U)}`)}),G("click",h,re),G("keydown",h,n=>{["Enter"," "].includes(n.key)&&(n.preventDefault(),re())}),G("click",Y,R),c(t,o)};z(oe,t=>{e(S)||t(we)})}var ke=f(oe,2);{var ye=t=>{var o=Ze(),h=f(i(o),2);Re(h,1,()=>e(w),je,(j,I,X)=>{var k=Ye(),q=i(k);q.textContent=`${X+1}.`;var N=f(q,2),Y=i(N,!0);l(N);var n=f(N,2),m=i(n,!0);l(n),l(k),K(()=>{A(Y,e(v)[e(I)]),A(m,e(Q)[e(I)])}),G("click",k,()=>B(e(I),!1)),G("keydown",k,C=>{["Enter"," "].includes(C.key)&&(C.preventDefault(),B(e(I),!1))}),c(j,k)}),l(o),c(t,o)};z(ke,t=>{e(S)&&t(ye)})}l(V);var ie=f(V,2);He(ie,{get buttons(){return e(ae)},$$events:{click:be,toggle:t=>a(p,t.detail.visible)}});var xe=f(ie,2);Oe(xe,t=>a(r,t),()=>e(r)),c(pe,ne),Ae(),ve()}export{ut as component};
