import{t as F,e as I,a as O,s as B}from"../chunks/DTjkHpgP.js";import"../chunks/DGCDY87e.js";import{a6 as oe,a7 as j,a8 as le,f as ne,a9 as de,s as $,g as e,a as i,e as t,ab as pe,m as q,c as m,r as p,t as A}from"../chunks/C1n7QiUv.js";import{i as G}from"../chunks/DxuJ5YGS.js";import{e as ve,i as ce}from"../chunks/CKqkeeWi.js";import{s as H}from"../chunks/Dh39w4RD.js";import{s as me}from"../chunks/35GQtHY4.js";import{s as J}from"../chunks/B81ulZpZ.js";import{b as fe}from"../chunks/DAIErdJE.js";import{i as ue}from"../chunks/CRfTq02u.js";import{s as ge,a as _e}from"../chunks/BcbruM5h.js";import{o as he,a as $e}from"../chunks/Dk0LuR_j.js";import{p as be}from"../chunks/BJ57T1Yb.js";import{b as ke}from"../chunks/BA7HluVP.js";import{C as ye}from"../chunks/B1AnoRyH.js";var xe=F('<div class="photo svelte-1d2haii"><div class="label svelte-1d2haii"> </div> <img class="svelte-1d2haii"></div>'),we=F('<div class="kor svelte-1d2haii"> </div>'),Se=F('<div><div class="speaker svelte-1d2haii"> </div> <div class="text"> </div> <!></div>'),Ee=F('<div class="wrap svelte-1d2haii"><div class="main svelte-1d2haii"><!> <div class="dialogue svelte-1d2haii"></div></div></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function Ve(L,Q){oe(Q,!1);const[U,W]=ge(),M=()=>_e(be,"$page",U),y=i(),u=i(),N=i();let d=i([]),x=i({}),l=i(-1),v=i(!1),c=i("none"),w=i("1.2em"),b=i(!0),k=i(!0),n=i();he(async()=>{if(!e(y))return;const a=await fetch(`${e(u)}/dialogue.json`);if(!a.ok)return;const o=await a.json();t(x,o.persons),t(d,o.conversation.map((r,s)=>({...r,file:`${e(u)}/audio/${String(s+1).padStart(2,"0")}.mp3`})))}),$e(()=>{var a;return(a=e(n))==null?void 0:a.pause()});async function g(a,o=!0){var r,s;if(a<0||a>=e(d).length){t(v,!1);return}t(l,a),await pe(),(r=document.getElementById(`segment-${a}`))==null||r.scrollIntoView({behavior:"smooth",block:"center"}),e(n).pause(),q(n,e(n).src=e(d)[a].file),q(n,e(n).muted=!!((s=e(x)[e(d)[a].speaker])!=null&&s.hideEnglish));try{await e(n).play()}catch{t(v,!1);return}t(v,!0)}function X(){e(c)==="segment"?g(e(l),!1):e(l)<e(d).length-1?g(e(l)+1):e(c)==="all"?g(0):t(v,!1)}function Y(){e(v)?(e(n).pause(),t(v,!1)):e(l)===-1?g(0):g(e(l),!1)}function Z(){t(c,e(c)==="none"?"all":e(c)==="all"?"segment":"none")}function ee(a){a.target.src=`${e(u)}/ready.webp`}function ae(a){switch(a.detail.id){case"play":Y();break;case"repeat":Z();break;case"kor":t(b,!e(b));break;case"size":t(w,e(w)==="1.2em"?"2em":"1.2em");break;case"photo":t(k,!e(k));break}}j(()=>M(),()=>{var a;t(y,((a=M().url.pathname.match(/\/dialogue\/([^\/]+)/))==null?void 0:a[1])||"")}),j(()=>e(y),()=>{t(u,`${ke}/assets/dialogue/${e(y)}`)}),j(()=>(e(v),e(c),e(b),e(k)),()=>{t(N,[{id:"play",icon:e(v)?"⏸":"▶"},{id:"repeat",text:`반복:${e(c)==="none"?"없음":e(c)==="all"?"전체":"구간"}`},{id:"kor",text:e(b)?"한글 ON":"한글 OFF"},{id:"size",text:"크기"},{id:"photo",text:e(k)?"사진 ON":"사진 OFF"}])}),le(),ue();var P=Ee(),C=ne(P),D=m(C),K=m(D);{var te=a=>{var o=xe(),r=m(o),s=m(r,!0);p(r);var _=$(r,2);p(o),A(()=>{var S,f,E;B(s,((f=e(x)[(S=e(d)[e(l)])==null?void 0:S.speaker])==null?void 0:f.name)||""),H(_,"src",(E=e(d)[e(l)])!=null&&E.speaker?`${e(u)}/${e(d)[e(l)].speaker}.webp`:`${e(u)}/ready.webp`)}),I("error",_,ee),O(a,o)};G(K,a=>{e(k)&&a(te)})}var R=$(K,2);ve(R,5,()=>e(d),ce,(a,o,r)=>{var s=Se();H(s,"id",`segment-${r}`);var _=m(s),S=m(_);p(_);var f=$(_,2),E=m(f,!0);p(f);var se=$(f,2);{var re=h=>{var z=we(),ie=m(z,!0);p(z),A(()=>{J(z,`font-size:${e(w)??""}`),B(ie,e(o).korean)}),O(h,z)};G(se,h=>{e(b)&&h(re)})}p(s),A(()=>{var h;me(s,1,`seg ${r===e(l)?"active":""}`,"svelte-1d2haii"),B(S,`${((h=e(x)[e(o).speaker])==null?void 0:h.name)??""}:`),J(f,`font-size:${e(w)??""}`),B(E,e(o).text)}),I("click",s,()=>g(r)),O(a,s)}),p(R),p(D),p(C);var T=$(C,2);ye(T,{get buttons(){return e(N)},$$events:{click:ae}});var V=$(T,2);fe(V,a=>t(n,a),()=>e(n)),I("ended",V,X),O(L,P),de(),W()}export{Ve as component};
