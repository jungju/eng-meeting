import{t as h,a as b,s as K,e as G}from"../chunks/CMAwb4th.js";import"../chunks/CthApk8F.js";import{a6 as Re,a7 as d,a8 as ze,f as ee,a9 as Be,g as e,a as r,s as f,e as a,ac as Ne,ab as Ge,aa as He,m as fe,c as u,r as g,t as H,O as Te}from"../chunks/DnBkWd9o.js";import{i as M}from"../chunks/3lh4epU4.js";import{e as Ue,i as We}from"../chunks/D7qEBDdj.js";import{s as qe}from"../chunks/DH_McDNf.js";import{b as Xe}from"../chunks/M8wP0stW.js";import{i as Fe}from"../chunks/RqZXrTMm.js";import{s as Je,a as Pe}from"../chunks/CKqP-jYq.js";import{o as Qe,a as Ve}from"../chunks/xvpwIJTT.js";import{p as Ye}from"../chunks/CHNwb1GQ.js";import{b as Ze}from"../chunks/CmDuc3nC.js";import{C as et}from"../chunks/My-eeozF.js";var tt=h('<div class="remain-big svelte-s4lrgb"> </div>'),at=h('<p class="kor svelte-s4lrgb"> </p>'),rt=h('<p class="eng svelte-s4lrgb"> </p>'),st=h('<p class="placeholder svelte-s4lrgb">•••</p>'),nt=h("<!> <!>",1),ot=h('<div role="button" tabindex="0"><div class="order-big svelte-s4lrgb"> </div> <!> <!></div> <button class="next-btn svelte-s4lrgb">NEXT ⏭</button>',1),lt=h('<div class="result-item svelte-s4lrgb" role="button" tabindex="0"><span class="num svelte-s4lrgb"></span><span class="eng txt svelte-s4lrgb"> </span><span class="kor txt svelte-s4lrgb"> </span></div>'),it=h('<div class="result-list svelte-s4lrgb"><h2 class="svelte-s4lrgb">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),ct=h('<main class="wrapper svelte-s4lrgb"><!> <!></main> <!> <audio playsinline="" preload="auto" class="svelte-s4lrgb"></audio>',1);function $t(ue,ge){Re(ge,!1);const[_e,me]=Je(),te=()=>Pe(Ye,"$page",_e),X=r(),A=r(),ae=r(),re=r(),y=r(),T=r(),F=r(),J=r(),se=r(),ne=[1e4,2e4,-1];let U=r(0),k=r([]),P=r([]),p=r(-1),Q=r(0),o=r(),x=r(!1),_=r(!1),D=!1,$=r(0),L;const O=new Set;let j=r([]),w=r(!1),i=r(0),R=r(!0);Qe(()=>(fetch(`${e(A)}/sentences.json`).then(t=>t.ok&&t.json()).then(t=>{t&&(a(k,t.sentences),a(P,t.korean))}),window.addEventListener("keydown",oe),()=>window.removeEventListener("keydown",oe))),Ve(()=>{var t;(t=e(o))==null||t.pause(),clearInterval(L)});function oe(t){e(w)||(["Space","ArrowRight"].includes(t.code)?(t.preventDefault(),S()):t.code==="ArrowLeft"&&e(j).length>1&&(t.preventDefault(),e(j).pop(),z(e(j).at(-1),!1,"eng")))}function be(){if(O.size===e(k).length)return-1;let t;do t=Math.floor(Math.random()*e(k).length);while(O.has(t));return t}async function z(t,s=!0,l="kor"){if(!(t<0||t>=e(k).length)){s&&Ge(Q),a(p,t),O.add(t),s&&e(j).push(t),await He(),e(o).pause(),fe(o,e(o).src=`${l==="kor"?e(re):e(ae)}/${String(t+1).padStart(2,"0")}.mp3`);try{await e(o).play(),a(x,!0)}catch{D=!0}}}function he(){e(o)&&fe(o,e(o).onended=()=>{if(a(x,!1),D){D=!1,S();return}if(e(y)>=0&&O.size<e(k).length){le();return}O.size===e(k).length&&a(w,!0)})}function le(){a(_,!0),a($,Math.ceil(e(y)/1e3)),L=setInterval(()=>{Ne($,-1)<=0&&(clearInterval(L),a(_,!1),e(x)?D=!0:S())},1e3)}function S(){e(o).pause(),clearInterval(L),a(x,a(_,D=!1)),a($,0);const t=be();if(t===-1){a(w,!0);return}z(t,!0,"kor")}const ke=(t,s)=>s===1?"_".repeat(t.length):s===2?t[0]+"_".repeat(t.length-1):t,xe=t=>e(i)===4?t:e(i)===3?t.split(" ").map((s,l)=>l%2?"_".repeat(s.length):s).join(" "):e(i)>0?t.split(" ").map(s=>ke(s,e(i))).join(" "):"",ie=()=>{e(o).pause(),clearInterval(L),a(x,a(_,D=!1)),a(p,-1),a(Q,a($,0)),O.clear(),a(j,[]),a(w,!1)},ye=()=>e(x)||e(_)||e(w)?ie():S(),$e=()=>a(i,(e(i)+1)%5),we=()=>a(R,!e(R)),Se=()=>{a(U,(e(U)+1)%ne.length),e(_)&&(clearInterval(L),a(_,!1),a($,0),le())},ce=t=>z(t,!1,"eng");function Ee(t){switch(t.detail.id){case"start":ye();break;case"hint":$e();break;case"kor":we();break;case"gap":Se();break}}d(()=>te(),()=>{a(X,te().params.id)}),d(()=>e(X),()=>{a(A,`${Ze}/assets/sentence/${e(X)}`)}),d(()=>e(A),()=>{a(ae,`${e(A)}/audio`)}),d(()=>e(A),()=>{a(re,`${e(A)}/audiok`)}),d(()=>e(U),()=>{a(y,ne[e(U)])}),d(()=>e(o),()=>{e(o)&&he()}),d(()=>(e(x),e(_)),()=>{a(T,e(x)||e(_))}),d(()=>e(y),()=>{a(F,e(y)<0?"∞":`${e(y)/1e3}s`)}),d(()=>e(i),()=>{a(J,`H${e(i)}`)}),d(()=>(e(T),e(J),e(i),e(R),e(F)),()=>{a(se,[{id:"start",icon:e(T)?"⏹":"▶"},{id:"hint",text:e(J),active:e(i)>0},{id:"kor",text:e(R)?"가":"한"},{id:"gap",text:e(F)}])}),ze(),Fe();var pe=ct(),V=ee(pe),ve=u(V);{var Ie=t=>{var s=ot(),l=ee(s),B=u(l),C=u(B,!0);g(B);var W=f(B,2);{var E=n=>{var c=tt(),I=u(c,!0);g(c),H(()=>K(I,e($))),b(n,c)};M(W,n=>{e(y)>=0&&e($)>0&&n(E)})}var q=f(W,2);{var N=n=>{var c=nt(),I=ee(c);{var Oe=v=>{var m=at(),Z=u(m,!0);g(m),H(()=>K(Z,e(P)[e(p)])),b(v,m)};M(I,v=>{e(R)&&v(Oe)})}var je=f(I,2);{var Ce=v=>{var m=rt(),Z=u(m,!0);g(m),H(Me=>K(Z,Me),[()=>xe(e(k)[e(p)])],Te),b(v,m)},Ke=v=>{var m=st();b(v,m)};M(je,v=>{e(i)>0?v(Ce):v(Ke,!1)})}b(n,c)};M(q,n=>{e(p)!==-1&&n(N)})}g(l);var Y=f(l,2);H(()=>{qe(l,1,`sentence-box ${e(T)?"playing":""}`,"svelte-s4lrgb"),K(C,e(p)===-1?"Ready":`#${e(Q)}`)}),G("click",l,function(...n){var c;(c=e(p)===-1?S:()=>z(e(p),!1,"eng"))==null||c.apply(this,n)}),G("keydown",l,n=>["Enter"," "].includes(n.key)&&(n.preventDefault(),e(p)===-1?S():z(e(p),!1,"eng"))),G("click",Y,S),b(t,s)};M(ve,t=>{e(w)||t(Ie)})}var Ae=f(ve,2);{var De=t=>{var s=it(),l=f(u(s),2);Ue(l,1,()=>e(j),We,(B,C,W)=>{var E=lt(),q=u(E);q.textContent=`${W+1}.`;var N=f(q),Y=u(N,!0);g(N);var n=f(N),c=u(n,!0);g(n),g(E),H(()=>{K(Y,e(k)[e(C)]),K(c,e(P)[e(C)])}),G("click",E,()=>ce(e(C))),G("keydown",E,I=>["Enter"," "].includes(I.key)&&(I.preventDefault(),ce(e(C)))),b(B,E)}),g(s),b(t,s)};M(Ae,t=>{e(w)&&t(De)})}g(V);var de=f(V,2);et(de,{get buttons(){return e(se)},$$events:{click:Ee}});var Le=f(de,2);Xe(Le,t=>a(o,t),()=>e(o)),b(ue,pe),Be(),me()}export{$t as component};
