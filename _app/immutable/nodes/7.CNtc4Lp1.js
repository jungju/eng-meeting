import"../chunks/NZTpNUN0.js";import{i as Ge}from"../chunks/BNVjIjhF.js";import{p as Je,a2 as r,a3 as Ne,t as F,f as pe,e as H,a as C,b as Pe,l as t,g as e,s as L,m as s,a8 as Re,a6 as ue,d as _,r as b,a9 as Ve,c as Xe,J as ve,h as Q,a5 as fe}from"../chunks/CX7M6nTm.js";import{i as me}from"../chunks/LrUez5h3.js";import{e as He,i as Qe}from"../chunks/DribQdv5.js";import{s as Ue}from"../chunks/p6kCGZxg.js";import{s as D}from"../chunks/BZO72TPf.js";import{s as We}from"../chunks/DF-Yt0Lv.js";import{b as Ye}from"../chunks/7ANmUOF5.js";import{s as Ze,a as et}from"../chunks/CJtuwylV.js";import{o as tt,a as at}from"../chunks/zff4H6P-.js";import{p as st}from"../chunks/BrNRiPaN.js";import{b as ot}from"../chunks/XqufQ7SV.js";import{C as nt}from"../chunks/J-pJPzLO.js";var it=F("<div> </div>"),rt=F('<div role="button" tabindex="0"><div class="ln svelte-1xcy4ta"><span class="idx svelte-1xcy4ta"></span> <div><div> </div> <div> </div> <!></div></div></div>'),lt=F("<p>로딩...</p>"),ct=F('<div class="list svelte-1xcy4ta"><!></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function $t(he,_e){Je(_e,!1);const[be,ge]=Ze(),U=()=>et(st,"$page",be),A=s(),I=s(),W=s(),z=s(),G=s(),J=s(),N=s(),Y=s();let d=s([]),Z=s([]),P=s([]),l=s(-1),n=s(),p=s(!1),o=s("all"),k=s(!1),ee=[],y=null;const R=[0,1e3,3e3,5e3];let g=s(0),v=s("both"),f=s("eng"),K=s(!0),M=s(!0),xe=100,V=[1,2,3,5],S=s(0),w=s(V[0]),T=0,te=s(0),$=[];tt(async()=>{if(!e(A))return;const a=await fetch(`${e(I)}/sentences.json`);if(a.ok){const i=await a.json();t(d,i.sentences),t(Z,i.korean),t(P,i.explanations??[])}}),at(()=>{e(n)?.pause(),y&&clearTimeout(y)});async function m(a){a<0||a>=e(d).length||(a!==e(l)&&(T=0),t(l,a),await Re(),document.getElementById(`s-${a}`)?.scrollIntoView({behavior:"smooth",block:"center"}),$=e(f)==="both"?["audio","audiok"]:e(f)==="kor"?["audiok"]:["audio"],await ae())}async function ae(){if(!$.length){t(p,!1);return}const a=$.shift();e(n).pause(),ue(n,e(n).src=`${e(I)}/${a}/${String(e(l)+1).padStart(2,"0")}.mp3`);try{await e(n).play(),t(p,!0)}catch{t(p,!1)}}function ke(){y=setTimeout(async()=>{if($.length)return await ae();if(e(o)==="one")return await m(e(l));if(e(o)==="all"){if(++T<e(w))return await m(e(l));T=0;const a=(e(l)+1)%e(d).length;if(!a&&Ve(te)>=xe){t(p,!1),t(o,"none");return}return await m(a)}++T<e(w)?await m(e(l)):t(p,!1)},R[e(g)])}const ye=()=>e(p)?(e(n).pause(),t(p,!1),$=[],y&&clearTimeout(y)):m(e(l)===-1?0:e(l)),we=()=>t(o,e(o)==="none"?"one":e(o)==="one"?"all":"none"),$e=()=>{e(o)!=="one"&&t(S,(e(S)+1)%V.length)},Ee=()=>t(f,e(f)==="eng"?"kor":e(f)==="kor"?"both":"eng"),Be=()=>{t(k,!e(k)),e(k)?(ee=[...e(d)],t(d,e(d).map(a=>{const i=a.split(" "),E=i.length,X=E<=2?1:E>=10?3:2,B=new Set;for(;B.size<X;)B.add(Math.floor(Math.random()*E));return i.map((c,u)=>B.has(u)?"____":c).join(" ")}))):t(d,[...ee])},Ce=()=>t(v,e(v)==="both"?"hideKor":e(v)==="hideKor"?"hideEng":"both"),Le=()=>t(g,(e(g)+1)%R.length),Ae=()=>t(M,!e(K));function Ke(a){switch(a.detail.id){case"play":ye();break;case"repeat":we();break;case"count":$e();break;case"disp":Ce();break;case"blank":Be();break;case"audio":Ee();break;case"gap":Le();break;case"exp":Ae();break}}r(()=>U(),()=>{t(A,U().url.pathname.match(/\/sentence\/([^\/]+)/)?.[1]||"")}),r(()=>e(A),()=>{t(I,`${ot}/assets/sentence/${e(A)}`)}),r(()=>e(S),()=>{t(w,V[e(S)])}),r(()=>e(K),()=>{t(W,e(K)?"calc(60px + env(safe-area-inset-bottom))":"env(safe-area-inset-bottom)")}),r(()=>e(o),()=>{e(o)!=="all"&&t(te,0)}),r(()=>e(n),()=>{e(n)&&ue(n,e(n).onended=ke)}),r(()=>e(g),()=>{t(z,e(g)?R[e(g)]/1e3+"s":"즉시")}),r(()=>e(v),()=>{t(G,e(v)==="both"?"한/영":e(v)==="hideKor"?"영":"한")}),r(()=>e(f),()=>{t(J,e(f)==="eng"?"영":e(f)==="kor"?"한":"모두")}),r(()=>e(M),()=>{t(N,e(M)?"설명ON":"설명OFF")}),r(()=>(e(p),e(o),e(w),e(G),e(k),e(J),e(z),e(N)),()=>{t(Y,[{id:"play",icon:e(p)?"⏸":"▶"},{id:"repeat",text:"반복:"+(e(o)==="none"?"없음":e(o)==="one"?"문장":"전체")},{id:"count",text:"횟수:"+e(w)+"x",active:e(o)!=="one"},{id:"disp",text:e(G)},{id:"blank",text:e(k)?"원문":"빈칸"},{id:"audio",text:"음성:"+e(J)},{id:"gap",text:"간격:"+e(z)},{id:"exp",text:e(N)}])}),Ne(),Ge();var se=ct(),j=pe(se),Me=_(j);{var Se=a=>{var i=Xe(),E=pe(i);He(E,1,()=>e(d),Qe,(X,B,c)=>{var u=rt();Ue(u,"id",`s-${c}`);var ne=_(u),ie=_(ne);ie.textContent=`${c+1}.`;var re=L(ie,2),O=_(re);let le;var Oe=_(O,!0);b(O);var q=L(O,2);let ce;var qe=_(q,!0);b(q);var De=L(q,2);{var Fe=h=>{var x=it();let de;var Ie=_(x,!0);b(x),H(ze=>{de=D(x,1,"ex svelte-1xcy4ta",null,de,ze),Q(Ie,e(P)[c])},[()=>({hidden:!e(M)})],ve),C(h,x)};me(De,h=>{e(P)[c]&&h(Fe)})}b(re),b(ne),b(u),H((h,x)=>{D(u,1,`sent ${c===e(l)?"act":""}`,"svelte-1xcy4ta"),le=D(O,1,"en svelte-1xcy4ta",null,le,h),Q(Oe,e(B)),ce=D(q,1,"ko svelte-1xcy4ta",null,ce,x),Q(qe,e(Z)[c])},[()=>({hidden:e(v)==="hideEng"}),()=>({hidden:e(v)==="hideKor"})],ve),fe("click",u,()=>m(c)),fe("keydown",u,h=>["Enter"," "].includes(h.key)&&m(c)),C(X,u)}),C(a,i)},Te=a=>{var i=lt();C(a,i)};me(Me,a=>{e(d).length?a(Se):a(Te,!1)})}b(j);var oe=L(j,2);nt(oe,{get buttons(){return e(Y)},$$events:{click:Ke,toggle:a=>t(K,a.detail.visible)}});var je=L(oe,2);Ye(je,a=>t(n,a),()=>e(n)),H(()=>We(j,`bottom:${e(W)}`)),C(he,se),Pe(),ge()}export{$t as component};
