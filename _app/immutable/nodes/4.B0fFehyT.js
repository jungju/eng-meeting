import"../chunks/NZTpNUN0.js";import{i as oe}from"../chunks/BNVjIjhF.js";import{p as le,a2 as F,a3 as ne,t as z,f as de,a5 as C,a as S,b as pe,s as h,g as e,l as t,m as s,a8 as ve,a6 as T,d as m,r as p,e as I,h as E}from"../chunks/CX7M6nTm.js";import{i as V}from"../chunks/LrUez5h3.js";import{e as ce,i as me}from"../chunks/DribQdv5.js";import{s as q}from"../chunks/p6kCGZxg.js";import{s as fe}from"../chunks/BZO72TPf.js";import{s as G}from"../chunks/DF-Yt0Lv.js";import{b as ue}from"../chunks/7ANmUOF5.js";import{s as ge,a as he}from"../chunks/CJtuwylV.js";import{o as _e,a as $e}from"../chunks/zff4H6P-.js";import{p as be}from"../chunks/B8cbdg0m.js";import{b as ke}from"../chunks/maFLIlvH.js";import{C as ye}from"../chunks/J-pJPzLO.js";var xe=z('<div class="photo svelte-1d2haii"><div class="label svelte-1d2haii"> </div> <img class="svelte-1d2haii"></div>'),we=z('<div class="kor svelte-1d2haii"> </div>'),Se=z('<div><div class="speaker svelte-1d2haii"> </div> <div class="text"> </div> <!></div>'),Ee=z('<div class="wrap svelte-1d2haii"><div class="main svelte-1d2haii"><!> <div class="dialogue svelte-1d2haii"></div></div></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function Te(H,J){le(J,!1);const[L,Q]=ge(),j=()=>he(be,"$page",L),b=s(),f=s(),A=s();let n=s([]),k=s({}),i=s(-1),v=s(!1),c=s("none"),y=s("1.2em"),_=s(!0),$=s(!0),o=s();_e(async()=>{if(!e(b))return;const a=await fetch(`${e(f)}/dialogue.json`);if(!a.ok)return;const r=await a.json();t(k,r.persons),t(n,r.conversation.map((d,l)=>({...d,file:`${e(f)}/audio/${String(l+1).padStart(2,"0")}.mp3`})))}),$e(()=>e(o)?.pause());async function u(a,r=!0){if(a<0||a>=e(n).length){t(v,!1);return}t(i,a),await ve(),document.getElementById(`segment-${a}`)?.scrollIntoView({behavior:"smooth",block:"center"}),e(o).pause(),T(o,e(o).src=e(n)[a].file),T(o,e(o).muted=!!e(k)[e(n)[a].speaker]?.hideEnglish);try{await e(o).play()}catch{t(v,!1);return}t(v,!0)}function U(){e(c)==="segment"?u(e(i),!1):e(i)<e(n).length-1?u(e(i)+1):e(c)==="all"?u(0):t(v,!1)}function W(){e(v)?(e(o).pause(),t(v,!1)):e(i)===-1?u(0):u(e(i),!1)}function X(){t(c,e(c)==="none"?"all":e(c)==="all"?"segment":"none")}function Y(a){a.target.src=`${e(f)}/ready.webp`}function Z(a){switch(a.detail.id){case"play":W();break;case"repeat":X();break;case"kor":t(_,!e(_));break;case"size":t(y,e(y)==="1.2em"?"2em":"1.2em");break;case"photo":t($,!e($));break}}F(()=>j(),()=>{t(b,j().url.pathname.match(/\/dialogue\/([^\/]+)/)?.[1]||"")}),F(()=>e(b),()=>{t(f,`${ke}/assets/dialogue/${e(b)}`)}),F(()=>(e(v),e(c),e(_),e($)),()=>{t(A,[{id:"play",icon:e(v)?"⏸":"▶"},{id:"repeat",text:`반복:${e(c)==="none"?"없음":e(c)==="all"?"전체":"구간"}`},{id:"kor",text:e(_)?"한글 ON":"한글 OFF"},{id:"size",text:"크기"},{id:"photo",text:e($)?"사진 ON":"사진 OFF"}])}),ne(),oe();var M=Ee(),O=de(M),N=m(O),P=m(N);{var ee=a=>{var r=xe(),d=m(r),l=m(d,!0);p(d);var g=h(d,2);p(r),I(()=>{E(l,e(k)[e(n)[e(i)]?.speaker]?.name||""),q(g,"src",e(n)[e(i)]?.speaker?`${e(f)}/${e(n)[e(i)].speaker}.webp`:`${e(f)}/ready.webp`)}),C("error",g,Y),S(a,r)};V(P,a=>{e($)&&a(ee)})}var D=h(P,2);ce(D,5,()=>e(n),me,(a,r,d)=>{var l=Se();q(l,"id",`segment-${d}`);var g=m(l),ae=m(g);p(g);var x=h(g,2),te=m(x,!0);p(x);var se=h(x,2);{var re=B=>{var w=we(),ie=m(w,!0);p(w),I(()=>{G(w,`font-size:${e(y)??""}`),E(ie,e(r).korean)}),S(B,w)};V(se,B=>{e(_)&&B(re)})}p(l),I(()=>{fe(l,1,`seg ${d===e(i)?"active":""}`,"svelte-1d2haii"),E(ae,`${e(k)[e(r).speaker]?.name??""}:`),G(x,`font-size:${e(y)??""}`),E(te,e(r).text)}),C("click",l,()=>u(d)),S(a,l)}),p(D),p(N),p(O);var K=h(O,2);ye(K,{get buttons(){return e(A)},$$events:{click:Z}});var R=h(K,2);ue(R,a=>t(o,a),()=>e(o)),C("ended",R,U),S(H,M),pe(),Q()}export{Te as component};
