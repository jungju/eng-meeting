import"../chunks/NZTpNUN0.js";import"../chunks/DUMHf_my.js";import{p as Ce,ag as A,ah as De,t as g,f as ee,a as c,b as Le,q as a,g as e,d as s,s as f,ai as Ae,ak as Me,m as le,e as i,r as l,al as ze,h as q,c as Be}from"../chunks/bplG7q_8.js";import{s as M,e as G}from"../chunks/CyL3djLh.js";import{i as z}from"../chunks/Cf2Bun1O.js";import{e as Re,i as je}from"../chunks/CPKHhc1S.js";import{s as Ne}from"../chunks/DzyRjOIa.js";import{b as Oe}from"../chunks/CgFHA2ll.js";import{i as Te}from"../chunks/BaxgYlCQ.js";import{s as qe,a as Ge}from"../chunks/CH-E4zoY.js";import{o as Ke,a as We}from"../chunks/C6rqwIBa.js";import{p as Xe}from"../chunks/BihwNUcq.js";import{b as Fe}from"../chunks/Byx2-Bn3.js";import{C as He}from"../chunks/BtjfU33a.js";var Je=g('<div class="remain-big svelte-hathbp"> </div>'),Pe=g('<p class="eng svelte-hathbp"> </p>'),Qe=g('<p class="kor svelte-hathbp"> </p>'),Ue=g('<p class="placeholder svelte-hathbp">•••</p>'),Ve=g('<div role="button" tabindex="0"><div class="order-big svelte-hathbp"> </div> <!> <!></div> <button class="next-btn svelte-hathbp">NEXT ⏭</button>',1),Ye=g('<div class="result-item svelte-hathbp" role="button" tabindex="0"><span class="num svelte-hathbp"></span> <span class="eng txt svelte-hathbp"> </span> <span class="kor txt svelte-hathbp"> </span></div>'),Ze=g('<div class="result-list svelte-hathbp"><h2 class="svelte-hathbp">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),et=g('<main class="wrapper svelte-hathbp"><!> <!></main> <!> <audio playsinline="" preload="auto" class="svelte-hathbp"></audio>',1);function ht(pe,ce){Ce(ce,!1);const[fe,ve]=qe(),te=()=>Ge(Xe,"$page",fe),F=s(),H=s(),J=s(),P=s(),ae=s();let v=s([]),Q=s([]),d=s(-1),U=s(0),r=s(),y=s(!1),_=s(!1),x=!1;const K=[1e4,2e4,-1];let u=s(K[0]),b=s(0),$;const E=new Set;let w=s([]),S=s(!1);Ke(async()=>{const t=await fetch(`${e(H)}/sentences.json`);if(t.ok){const o=await t.json();a(v,o.sentences),a(Q,o.korean)}typeof window<"u"&&window.addEventListener("keydown",se)}),We(()=>{e(r)?.pause(),clearInterval($),typeof window<"u"&&window.removeEventListener("keydown",se)});function se(t){e(S)||(["Space","ArrowRight"].includes(t.code)?(t.preventDefault(),R()):t.code==="ArrowLeft"&&e(w).length>1&&(t.preventDefault(),e(w).pop(),B(e(w)[e(w).length-1],!1)))}function de(){if(E.size===e(v).length)return-1;let t;do t=Math.floor(Math.random()*e(v).length);while(E.has(t));return t}async function B(t,o=!0){if(!(t<0||t>=e(v).length)){o&&Ae(U),a(d,t),E.add(t),o&&e(w).push(t),await Me(),e(r).pause(),le(r,e(r).src=`${e(H)}/audio/${String(t+1).padStart(2,"0")}.mp3`);try{await e(r).play(),a(y,!0)}catch{x=!0}}}function ue(){e(r)&&le(r,e(r).onended=()=>{if(a(y,!1),x){x=!1,R();return}if(e(u)>=0&&E.size<e(v).length){he();return}E.size===e(v).length&&a(S,!0)})}function he(){a(_,!0),a(b,Math.ceil(e(u)/1e3)),$=setInterval(()=>{ze(b,-1)<=0&&(clearInterval($),a(_,!1),e(y)?x=!0:R())},1e3)}function R(){e(r).pause(),clearInterval($),a(y,a(_,x=!1)),a(b,0);const t=de();if(t===-1){a(S,!0);return}B(t)}function re(){e(d)===-1?R():B(e(d),!1)}function me(){e(r).pause(),clearInterval($),a(y,a(_,x=!1)),a(d,-1),a(U,0),a(b,0),E.clear(),a(w,[]),a(S,!1)}let p=s("none");function ge(){a(p,e(p)==="none"?"eng":e(p)==="eng"?"kor":"none")}function _e(t){a(u,t),e(_)&&(clearInterval($),a(_,!1),a(b,0))}function be(t){switch(t.detail.id){case"stop":me();break;case"show":ge();break;case"gap":_e(K[(K.indexOf(e(u))+1)%K.length]);break}}A(()=>te(),()=>{a(F,te().params.id)}),A(()=>e(F),()=>{a(H,`${Fe}/assets/sentence/${e(F)}`)}),A(()=>e(r),()=>{e(r)&&ue()}),A(()=>e(p),()=>{a(J,e(p)==="none"?"표시:없음":e(p)==="eng"?"표시:영어":"표시:한글")}),A(()=>e(u),()=>{a(P,e(u)<0?"무제한":`${e(u)/1e3}s`)}),A(()=>(e(J),e(P)),()=>{a(ae,[{id:"stop",icon:"⏹"},{id:"show",text:e(J)},{id:"gap",text:`간격:${e(P)}`}])}),De(),Te();var ne=et(),V=ee(ne),oe=i(V);{var we=t=>{var o=Ve(),h=ee(o),j=i(h),I=i(j,!0);l(j);var W=f(j,2);{var k=n=>{var m=Je(),C=i(m,!0);l(m),q(()=>M(C,e(b))),c(n,m)};z(W,n=>{e(u)>=0&&e(b)>0&&n(k)})}var X=f(W,2);{var N=n=>{var m=Be(),C=ee(m);{var $e=D=>{var O=Pe(),Z=i(O,!0);l(O),q(()=>M(Z,e(v)[e(d)])),c(D,O)},Ee=(D,O)=>{{var Z=L=>{var T=Qe(),Ie=i(T,!0);l(T),q(()=>M(Ie,e(Q)[e(d)])),c(L,T)},Se=L=>{var T=Ue();c(L,T)};z(D,L=>{e(p)==="kor"?L(Z):L(Se,!1)},O)}};z(C,D=>{e(p)==="eng"?D($e):D(Ee,!1)})}c(n,m)};z(X,n=>{e(d)!==-1&&n(N)})}l(h);var Y=f(h,2);q(()=>{Ne(h,1,`sentence-box ${e(y)||e(_)?"playing":""}`,"svelte-hathbp"),M(I,e(d)===-1?"Ready":`#${e(U)}`)}),G("click",h,re),G("keydown",h,n=>{["Enter"," "].includes(n.key)&&(n.preventDefault(),re())}),G("click",Y,R),c(t,o)};z(oe,t=>{e(S)||t(we)})}var ke=f(oe,2);{var ye=t=>{var o=Ze(),h=f(i(o),2);Re(h,1,()=>e(w),je,(j,I,W)=>{var k=Ye(),X=i(k);X.textContent=`${W+1}.`;var N=f(X,2),Y=i(N,!0);l(N);var n=f(N,2),m=i(n,!0);l(n),l(k),q(()=>{M(Y,e(v)[e(I)]),M(m,e(Q)[e(I)])}),G("click",k,()=>B(e(I),!1)),G("keydown",k,C=>{["Enter"," "].includes(C.key)&&(C.preventDefault(),B(e(I),!1))}),c(j,k)}),l(o),c(t,o)};z(ke,t=>{e(S)&&t(ye)})}l(V);var ie=f(V,2);He(ie,{get buttons(){return e(ae)},$$events:{click:be,toggle:t=>a(p,t.detail.visible)}});var xe=f(ie,2);Oe(xe,t=>a(r,t),()=>e(r)),c(pe,ne),Le(),ve()}export{ht as component};
