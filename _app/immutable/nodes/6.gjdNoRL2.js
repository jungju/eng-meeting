import{t as V,a as K,c as Ke,s as oe,e as ne}from"../chunks/CMAwb4th.js";import"../chunks/CthApk8F.js";import{a6 as Me,a7 as l,a8 as Se,f as ie,t as re,a9 as Te,e as a,g as e,a as s,s as M,aa as je,m as le,c as _,r as b,ac as qe,O as De}from"../chunks/DnBkWd9o.js";import{i as Ie}from"../chunks/3lh4epU4.js";import{e as Oe,i as Re}from"../chunks/D7qEBDdj.js";import{s as ze}from"../chunks/B4ApMTmW.js";import{s as P}from"../chunks/DH_McDNf.js";import{s as Ge}from"../chunks/CsZV0hbc.js";import{b as Pe}from"../chunks/M8wP0stW.js";import{i as Ve}from"../chunks/RqZXrTMm.js";import{s as Xe,a as Fe}from"../chunks/CKqP-jYq.js";import{o as He,a as Je}from"../chunks/xvpwIJTT.js";import{p as Ne}from"../chunks/DtNlNPeX.js";import{b as Qe}from"../chunks/NdyFrVzL.js";import{C as Ue}from"../chunks/CeMdoRY0.js";var We=V('<div role="button" tabindex="0"><div class="ln svelte-17vkxto"><span class="idx svelte-17vkxto"></span> <div><div> </div> <div> </div></div></div></div>'),Ye=V("<p>로딩...</p>"),Ze=V('<div class="list svelte-17vkxto"><!></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function mt(ce,de){Me(de,!1);const[pe,fe]=Xe(),X=()=>Fe(Ne,"$page",pe),B=s(),S=s(),F=s(),T=s(),j=s(),q=s(),H=s();let c=s([]),J=s([]),r=s(-1),i=s(),d=s(!1),o=s("none"),g=s(!1),N=[],k=null;const D=[0,1e3,3e3,5e3];let h=s(0),f=s("both"),u=s("eng"),I=s(!0);const ue=100,O=[1,2,3,5];let C=s(0),x=s(O[0]),E=0,Q=s(0),y=[];He(async()=>{if(!e(B))return;const t=await fetch(`${e(S)}/sentences.json`);if(t.ok){const n=await t.json();a(c,n.sentences),a(J,n.korean)}}),Je(()=>{var t;(t=e(i))==null||t.pause(),k&&clearTimeout(k)});async function m(t){var n;t<0||t>=e(c).length||(t!==e(r)&&(E=0),a(r,t),await je(),(n=document.getElementById(`s-${t}`))==null||n.scrollIntoView({behavior:"smooth",block:"center"}),y=e(u)==="both"?["audio","audiok"]:e(u)==="kor"?["audiok"]:["audio"],await U())}async function U(){if(!y.length){a(d,!1);return}const t=y.shift();e(i).pause(),le(i,e(i).src=`${e(S)}/${t}/${String(e(r)+1).padStart(2,"0")}.mp3`);try{await e(i).play(),a(d,!0)}catch{a(d,!1)}}function ve(){k=setTimeout(async()=>{if(y.length){await U();return}if(e(o)==="one"){await m(e(r));return}if(e(o)==="all"){if(++E<e(x)){await m(e(r));return}E=0;const t=(e(r)+1)%e(c).length;if(!t&&qe(Q)>=ue){a(d,!1),a(o,"none");return}await m(t);return}++E<e(x)?await m(e(r)):a(d,!1)},D[e(h)])}const me=()=>e(d)?(e(i).pause(),a(d,!1),y=[],k&&clearTimeout(k)):m(e(r)===-1?0:e(r)),he=()=>a(o,e(o)==="none"?"one":e(o)==="one"?"all":"none"),_e=()=>{e(o)!=="one"&&a(C,(e(C)+1)%O.length)},be=()=>a(u,e(u)==="eng"?"kor":e(u)==="kor"?"both":"eng"),ge=()=>{a(g,!e(g)),e(g)?(N=[...e(c)],a(c,e(c).map(t=>{const n=t.split(" "),w=n.length,R=w<=2?1:w>=10?3:2,$=new Set;for(;$.size<R;)$.add(Math.floor(Math.random()*w));return n.map((v,p)=>$.has(p)?"____":v).join(" ")}))):a(c,[...N])},ke=()=>a(f,e(f)==="both"?"hideKor":e(f)==="hideKor"?"hideEng":"both"),xe=()=>a(h,(e(h)+1)%D.length);function ye(t){switch(t.detail.id){case"play":me();break;case"repeat":he();break;case"count":_e();break;case"disp":ke();break;case"blank":ge();break;case"audio":be();break;case"gap":xe();break}}l(()=>X(),()=>{var t;a(B,((t=X().url.pathname.match(/\/sentence\/([^\/]+)/))==null?void 0:t[1])||"")}),l(()=>e(B),()=>{a(S,`${Qe}/assets/sentence/${e(B)}`)}),l(()=>e(C),()=>{a(x,O[e(C)])}),l(()=>e(I),()=>{a(F,e(I)?"calc(60px + env(safe-area-inset-bottom))":"env(safe-area-inset-bottom)")}),l(()=>e(o),()=>{e(o)!=="all"&&a(Q,0)}),l(()=>e(i),()=>{e(i)&&le(i,e(i).onended=ve)}),l(()=>e(h),()=>{a(T,e(h)?D[e(h)]/1e3+"s":"즉시")}),l(()=>e(f),()=>{a(j,e(f)==="both"?"한/영":e(f)==="hideKor"?"영":"한")}),l(()=>e(u),()=>{a(q,e(u)==="eng"?"영":e(u)==="kor"?"한":"모두")}),l(()=>(e(d),e(o),e(x),e(j),e(g),e(q),e(T)),()=>{a(H,[{id:"play",icon:e(d)?"⏸":"▶"},{id:"repeat",text:"반복:"+(e(o)==="none"?"없음":e(o)==="one"?"문장":"전체")},{id:"count",text:"횟수:"+e(x)+"x",active:e(o)!=="one",aria:"Repeat count"},{id:"disp",text:e(j)},{id:"blank",text:e(g)?"원문":"빈칸"},{id:"audio",text:"음성:"+e(q)},{id:"gap",text:"간격:"+e(T)}])}),Se(),Ve();var W=Ze(),L=ie(W),we=_(L);{var $e=t=>{var n=Ke(),w=ie(n);Oe(w,1,()=>e(c),Re,(R,$,v)=>{var p=We();ze(p,"id",`s-${v}`);var Z=_(p),ee=_(Z);ee.textContent=`${v+1}.`;var te=M(ee,2),A=_(te);let ae;var Ee=_(A,!0);b(A);var z=M(A,2);let se;var Le=_(z,!0);b(z),b(te),b(Z),b(p),re((G,Ae)=>{P(p,1,`sent ${v===e(r)?"act":""}`,"svelte-17vkxto"),ae=P(A,1,"en svelte-17vkxto",null,ae,G),oe(Ee,e($)),se=P(z,1,"ko svelte-17vkxto",null,se,Ae),oe(Le,e(J)[v])},[()=>({hidden:e(f)==="hideEng"}),()=>({hidden:e(f)==="hideKor"})],De),ne("click",p,()=>m(v)),ne("keydown",p,G=>["Enter"," "].includes(G.key)&&m(v)),K(R,p)}),K(t,n)},Be=t=>{var n=Ye();K(t,n)};Ie(we,t=>{e(c).length?t($e):t(Be,!1)})}b(L);var Y=M(L,2);Ue(Y,{get buttons(){return e(H)},$$events:{click:ye,toggle:t=>a(I,t.detail.visible)}});var Ce=M(Y,2);Pe(Ce,t=>a(i,t),()=>e(i)),re(()=>Ge(L,`bottom:${e(F)}`)),K(ce,W),Te(),fe()}export{mt as component};
