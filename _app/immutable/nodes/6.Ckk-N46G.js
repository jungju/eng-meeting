import{t as D,a as L,c as ze,s as J,e as pe}from"../chunks/CMAwb4th.js";import"../chunks/CthApk8F.js";import{a6 as Ge,a7 as r,a8 as Ne,f as ue,t as Q,a9 as Pe,e as a,g as e,a as s,s as A,aa as Ve,m as fe,c as h,r as b,ac as Xe,O as ve}from"../chunks/DnBkWd9o.js";import{i as me}from"../chunks/3lh4epU4.js";import{e as He,i as Je}from"../chunks/D7qEBDdj.js";import{s as Qe}from"../chunks/B4ApMTmW.js";import{s as q}from"../chunks/DH_McDNf.js";import{s as Ue}from"../chunks/CsZV0hbc.js";import{b as We}from"../chunks/M8wP0stW.js";import{i as Ye}from"../chunks/RqZXrTMm.js";import{s as Ze,a as et}from"../chunks/CKqP-jYq.js";import{o as tt,a as at}from"../chunks/xvpwIJTT.js";import{p as st}from"../chunks/DYyComWw.js";import{b as ot}from"../chunks/CGcbVnJG.js";import{C as nt}from"../chunks/CeMdoRY0.js";var it=D("<div> </div>"),rt=D('<div role="button" tabindex="0"><div class="ln svelte-1kxwiw3"><span class="idx svelte-1kxwiw3"></span> <div><div> </div> <div> </div> <!></div></div></div>'),lt=D("<p>로딩...</p>"),ct=D('<div class="list svelte-1kxwiw3"><!></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function Et(_e,he){Ge(he,!1);const[be,ge]=Ze(),U=()=>et(st,"$page",be),K=s(),F=s(),W=s(),I=s(),R=s(),z=s(),G=s(),Y=s();let d=s([]),Z=s([]),N=s([]),l=s(-1),i=s(),p=s(!1),n=s("none"),x=s(!1),ee=[],w=null;const P=[0,1e3,3e3,5e3];let g=s(0),f=s("both"),v=s("eng"),V=s(!0),y=s(!0);const ke=100,X=[1,2,3,5];let M=s(0),$=s(X[0]),O=0,te=s(0),E=[];tt(async()=>{if(!e(K))return;const t=await fetch(`${e(F)}/sentences.json`);if(t.ok){const o=await t.json();a(d,o.sentences),a(Z,o.korean),a(N,o.explanations??[])}}),at(()=>{var t;(t=e(i))==null||t.pause(),w&&clearTimeout(w)});async function m(t){var o;t<0||t>=e(d).length||(t!==e(l)&&(O=0),a(l,t),await Ve(),(o=document.getElementById(`s-${t}`))==null||o.scrollIntoView({behavior:"smooth",block:"center"}),E=e(v)==="both"?["audio","audiok"]:e(v)==="kor"?["audiok"]:["audio"],await ae())}async function ae(){if(!E.length){a(p,!1);return}const t=E.shift();e(i).pause(),fe(i,e(i).src=`${e(F)}/${t}/${String(e(l)+1).padStart(2,"0")}.mp3`);try{await e(i).play(),a(p,!0)}catch{a(p,!1)}}function xe(){w=setTimeout(async()=>{if(E.length){await ae();return}if(e(n)==="one"){await m(e(l));return}if(e(n)==="all"){if(++O<e($)){await m(e(l));return}O=0;const t=(e(l)+1)%e(d).length;if(!t&&Xe(te)>=ke){a(p,!1),a(n,"none");return}await m(t);return}++O<e($)?await m(e(l)):a(p,!1)},P[e(g)])}const we=()=>e(p)?(e(i).pause(),a(p,!1),E=[],w&&clearTimeout(w)):m(e(l)===-1?0:e(l)),ye=()=>a(n,e(n)==="none"?"one":e(n)==="one"?"all":"none"),$e=()=>{e(n)!=="one"&&a(M,(e(M)+1)%X.length)},Ee=()=>a(v,e(v)==="eng"?"kor":e(v)==="kor"?"both":"eng"),Be=()=>{a(x,!e(x)),e(x)?(ee=[...e(d)],a(d,e(d).map(t=>{const o=t.split(" "),B=o.length,H=B<=2?1:B>=10?3:2,C=new Set;for(;C.size<H;)C.add(Math.floor(Math.random()*B));return o.map((c,u)=>C.has(u)?"____":c).join(" ")}))):a(d,[...ee])},Ce=()=>a(f,e(f)==="both"?"hideKor":e(f)==="hideKor"?"hideEng":"both"),Le=()=>a(g,(e(g)+1)%P.length),Ae=()=>a(y,!e(y));function Ke(t){switch(t.detail.id){case"play":we();break;case"repeat":ye();break;case"count":$e();break;case"disp":Ce();break;case"blank":Be();break;case"audio":Ee();break;case"gap":Le();break;case"exp":Ae();break}}r(()=>U(),()=>{var t;a(K,((t=U().url.pathname.match(/\/sentence\/([^\/]+)/))==null?void 0:t[1])||"")}),r(()=>e(K),()=>{a(F,`${ot}/assets/sentence/${e(K)}`)}),r(()=>e(M),()=>{a($,X[e(M)])}),r(()=>e(V),()=>{a(W,e(V)?"calc(60px + env(safe-area-inset-bottom))":"env(safe-area-inset-bottom)")}),r(()=>e(n),()=>{e(n)!=="all"&&a(te,0)}),r(()=>e(i),()=>{e(i)&&fe(i,e(i).onended=xe)}),r(()=>e(g),()=>{a(I,e(g)?P[e(g)]/1e3+"s":"즉시")}),r(()=>e(f),()=>{a(R,e(f)==="both"?"한/영":e(f)==="hideKor"?"영":"한")}),r(()=>e(v),()=>{a(z,e(v)==="eng"?"영":e(v)==="kor"?"한":"모두")}),r(()=>e(y),()=>{a(G,e(y)?"설명ON":"설명OFF")}),r(()=>(e(p),e(n),e($),e(R),e(x),e(z),e(I),e(G)),()=>{a(Y,[{id:"play",icon:e(p)?"⏸":"▶"},{id:"repeat",text:"반복:"+(e(n)==="none"?"없음":e(n)==="one"?"문장":"전체")},{id:"count",text:"횟수:"+e($)+"x",active:e(n)!=="one",aria:"Repeat count"},{id:"disp",text:e(R)},{id:"blank",text:e(x)?"원문":"빈칸"},{id:"audio",text:"음성:"+e(z)},{id:"gap",text:"간격:"+e(I)},{id:"exp",text:e(G)}])}),Ne(),Ye();var se=ct(),S=ue(se),Me=h(S);{var Oe=t=>{var o=ze(),B=ue(o);He(B,1,()=>e(d),Je,(H,C,c)=>{var u=rt();Qe(u,"id",`s-${c}`);var ne=h(u),ie=h(ne);ie.textContent=`${c+1}.`;var re=A(ie,2),T=h(re);let le;var je=h(T,!0);b(T);var j=A(T,2);let ce;var qe=h(j,!0);b(j);var De=A(j,2);{var Fe=_=>{var k=it();let de;var Ie=h(k,!0);b(k),Q(Re=>{de=q(k,1,"ex svelte-1kxwiw3",null,de,Re),J(Ie,e(N)[c])},[()=>({hidden:!e(y)})],ve),L(_,k)};me(De,_=>{e(N)[c]&&_(Fe)})}b(re),b(ne),b(u),Q((_,k)=>{q(u,1,`sent ${c===e(l)?"act":""}`,"svelte-1kxwiw3"),le=q(T,1,"en svelte-1kxwiw3",null,le,_),J(je,e(C)),ce=q(j,1,"ko svelte-1kxwiw3",null,ce,k),J(qe,e(Z)[c])},[()=>({hidden:e(f)==="hideEng"}),()=>({hidden:e(f)==="hideKor"})],ve),pe("click",u,()=>m(c)),pe("keydown",u,_=>["Enter"," "].includes(_.key)&&m(c)),L(H,u)}),L(t,o)},Se=t=>{var o=lt();L(t,o)};me(Me,t=>{e(d).length?t(Oe):t(Se,!1)})}b(S);var oe=A(S,2);nt(oe,{get buttons(){return e(Y)},$$events:{click:Ke,toggle:t=>a(V,t.detail.visible)}});var Te=A(oe,2);We(Te,t=>a(i,t),()=>e(i)),Q(()=>Ue(S,`bottom:${e(W)}`)),L(_e,se),Pe(),ge()}export{Et as component};
