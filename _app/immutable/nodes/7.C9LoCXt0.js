import"../chunks/NZTpNUN0.js";import{i as Ie}from"../chunks/tEBiHiVF.js";import{q as Me,D as l,F as Oe,u as S,G as oe,A as N,v as C,w as Pe,s as t,g as e,z as E,m as s,P as je,M as ne,y as _,x as k,I as qe,Q as Ge,J as Re,C as Q,K as re}from"../chunks/CwV636Gc.js";import{i as ie}from"../chunks/BpFCBlOt.js";import{e as ze,s as V,i as Je}from"../chunks/lfAz8Y32.js";import{s as Ne}from"../chunks/BGfsMArk.js";import{s as Qe}from"../chunks/Bk8RznBR.js";import{b as Ve}from"../chunks/S5asknXf.js";import{s as Xe,a as He}from"../chunks/C3Q7PnuQ.js";import{o as Ue,a as We}from"../chunks/Dcbe9JOZ.js";import{p as Ye}from"../chunks/WDp4Gvtj.js";import{b as Ze}from"../chunks/C15mtvTj.js";import{C as et}from"../chunks/D51qih5w.js";var tt=S('<span class="rep-pill svelte-pp062g"> </span>'),at=S('<div role="button" tabindex="0"><div class="card-head svelte-pp062g"><span class="card-index svelte-pp062g"></span> <div class="card-lines svelte-pp062g"><p> </p> <p> </p></div></div> <!></div>'),st=S('<p class="loading svelte-pp062g">로딩...</p>'),ot=S('<div class="list svelte-pp062g"><!></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function ht(le,pe){Me(pe,!1);const[ce,de]=Xe(),X=()=>He(Ye,"$page",ce),L=s(),D=s(),H=s(),F=s(),I=s(),M=s(),O=s(),U=s();let w=s([]),W=s([]),i=s(-1),n=s(),r=s(!1),o=s("all"),v=null,p=s(!1),c=null,P="all";const j=[0,1e3,3e3,5e3];let y=s(0),u=s("both"),f=s("eng"),q=s(!0),ue=100,G=[1,3,5,10],A=s(0),x=s(G[0]),d=s(0),Y=s(0),$=[];Ue(async()=>{if(!e(L))return;const a=await fetch(`${e(D)}/sentences.json`);if(a.ok){const g=await a.json();t(w,g.sentences),t(W,g.korean)}}),We(()=>{e(n)?.pause(),v&&clearTimeout(v),c&&clearTimeout(c)});async function m(a){a<0||a>=e(w).length||(a!==e(i)&&t(d,0),t(i,a),await je(),document.getElementById(`s-${a}`)?.scrollIntoView({behavior:"smooth",block:"center"}),$=e(f)==="both"?["audio","audiok"]:e(f)==="kor"?["audiok"]:["audio"],await Z())}async function Z(){if(!$.length){t(r,!1);return}const a=$.shift();e(n).pause(),ne(n,e(n).src=`${e(D)}/${a}/${String(e(i)+1).padStart(2,"0")}.mp3`);try{await e(n).play(),t(r,!0)}catch{t(r,!1)}}function fe(){v=setTimeout(async()=>{if($.length)return await Z();if(qe(d),e(o)==="all"){if(e(d)<e(x))return await m(e(i));t(d,0);const a=(e(i)+1)%e(w).length;if(!a&&Ge(Y)>=ue){t(r,!1),t(o,"none");return}return await m(a)}if(e(o)==="one"){if(e(d)<e(x))return await m(e(i));t(r,!1);return}if(e(d)<e(x))return await m(e(i));t(r,!1)},j[e(y)])}const ve=()=>e(r)?(e(n).pause(),t(r,!1),$=[],v&&clearTimeout(v)):m(e(i)===-1?0:e(i)),me=()=>{e(p)||(t(o,e(o)==="none"?"one":e(o)==="one"?"all":"none"),t(d,0))},ge=()=>{t(A,(e(A)+1)%G.length),t(d,0)},be=()=>{t(f,e(f)==="eng"?"kor":e(f)==="kor"?"both":"eng")},he=()=>t(u,e(u)==="both"?"hideKor":e(u)==="hideKor"?"hideEng":"both"),_e=()=>t(y,(e(y)+1)%j.length),ke=()=>{e(n)?.pause(),t(r,!1),$=[],v&&clearTimeout(v)},ye=()=>{e(p)?(t(p,!1),c&&clearTimeout(c),c=null,t(o,P)):(P=e(o),t(o,"all"),t(p,!0),c&&clearTimeout(c),c=setTimeout(()=>{ke(),t(p,!1),c=null,t(o,P)},18e5))};function xe(a){switch(a.detail.id){case"play":ve();break;case"repeat":me();break;case"count":ge();break;case"disp":he();break;case"audio":be();break;case"gap":_e();break;case"sleep":ye();break}}l(()=>X(),()=>{t(L,X().url.pathname.match(/\/sentence\/([^\/]+)/)?.[1]||"")}),l(()=>e(L),()=>{t(D,`${Ze}/assets/sentence/${e(L)}`)}),l(()=>e(A),()=>{t(x,G[e(A)])}),l(()=>e(q),()=>{t(H,e(q)?"calc(60px + env(safe-area-inset-bottom))":"env(safe-area-inset-bottom)")}),l(()=>e(o),()=>{e(o)!=="all"&&t(Y,0)}),l(()=>e(n),()=>{e(n)&&ne(n,e(n).onended=fe)}),l(()=>e(y),()=>{t(F,e(y)?j[e(y)]/1e3+"s":"즉시")}),l(()=>e(u),()=>{t(I,e(u)==="both"?"한/영":e(u)==="hideKor"?"영":"한")}),l(()=>e(f),()=>{t(M,e(f)==="eng"?"영":e(f)==="kor"?"한":"모두")}),l(()=>e(p),()=>{t(O,e(p)?"슬립ON":"슬립OFF")}),l(()=>(e(r),e(o),e(x),e(I),e(M),e(F),e(O),e(p)),()=>{t(U,[{id:"play",icon:e(r)?"⏸":"▶"},{id:"repeat",text:"반복:"+(e(o)==="none"?"없음":e(o)==="one"?"문장":"전체")},{id:"count",text:"횟수:"+e(x)+"x",active:!0},{id:"disp",text:e(I)},{id:"audio",text:"음성:"+e(M)},{id:"gap",text:"간격:"+e(F)},{id:"sleep",text:e(O),active:e(p)}])}),Oe(),Ie();var ee=ot(),B=oe(ee),$e=_(B);{var we=a=>{var g=Re(),Ee=oe(g);ze(Ee,1,()=>e(w),Je,(Le,Ae,b)=>{var h=at();Ne(h,"id",`s-${b}`);var R=_(h),ae=_(R);ae.textContent=`${b+1}.`;var se=E(ae,2),K=_(se),Be=_(K,!0);k(K);var z=E(K,2),Ke=_(z,!0);k(z),k(se),k(R);var Se=E(R,2);{var De=T=>{var J=tt(),Fe=_(J,!0);k(J),N(()=>Q(Fe,e(d)+1)),C(T,J)};ie(Se,T=>{e(r)&&b===e(i)&&T(De)})}k(h),N(()=>{V(h,1,`sentence-card ${e(r)&&b===e(i)?"active":""}`,"svelte-pp062g"),V(K,1,`line en ${e(u)==="hideEng"?"hidden":""}`,"svelte-pp062g"),Q(Be,e(Ae)),V(z,1,`line ko ${e(u)==="hideKor"?"hidden":""}`,"svelte-pp062g"),Q(Ke,e(W)[b])}),re("click",h,()=>m(b)),re("keydown",h,T=>["Enter"," "].includes(T.key)&&m(b)),C(Le,h)}),C(a,g)},Te=a=>{var g=st();C(a,g)};ie($e,a=>{e(w).length?a(we):a(Te,!1)})}k(B);var te=E(B,2);et(te,{get buttons(){return e(U)},$$events:{click:xe,toggle:a=>t(q,a.detail.visible)}});var Ce=E(te,2);Ve(Ce,a=>t(n,a),()=>e(n)),N(()=>Qe(B,`--list-bottom:${e(H)}`)),C(le,ee),Pe(),de()}export{ht as component};
