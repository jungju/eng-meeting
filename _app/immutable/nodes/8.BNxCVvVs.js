import"../chunks/NZTpNUN0.js";import"../chunks/DUMHf_my.js";import{p as ze,ag as i,ah as Ge,t as F,f as pe,h as J,a as C,b as Ne,q as t,g as e,d as s,s as L,ak as Pe,m as fe,e as _,r as b,al as Ve,c as Xe,R as ue}from"../chunks/bplG7q_8.js";import{s as Q,e as ve}from"../chunks/CyL3djLh.js";import{i as me}from"../chunks/Cf2Bun1O.js";import{e as He,i as Je}from"../chunks/CPKHhc1S.js";import{s as Qe}from"../chunks/CWIKjPFz.js";import{s as D}from"../chunks/DzyRjOIa.js";import{s as Ue}from"../chunks/N0OzDCDk.js";import{b as We}from"../chunks/CgFHA2ll.js";import{i as Ye}from"../chunks/BaxgYlCQ.js";import{s as Ze,a as et}from"../chunks/CH-E4zoY.js";import{o as tt,a as at}from"../chunks/C6rqwIBa.js";import{p as st}from"../chunks/DJ4sZ1FQ.js";import{b as ot}from"../chunks/c9S6XF28.js";import{C as nt}from"../chunks/BtjfU33a.js";var rt=F("<div> </div>"),it=F('<div role="button" tabindex="0"><div class="ln svelte-1xcy4ta"><span class="idx svelte-1xcy4ta"></span> <div><div> </div> <div> </div> <!></div></div></div>'),lt=F("<p>로딩...</p>"),ct=F('<div class="list svelte-1xcy4ta"><!></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function Bt(he,_e){ze(_e,!1);const[be,ge]=Ze(),U=()=>et(st,"$page",be),A=s(),I=s(),W=s(),R=s(),z=s(),G=s(),N=s(),Y=s();let d=s([]),Z=s([]),P=s([]),l=s(-1),n=s(),p=s(!1),o=s("none"),k=s(!1),ee=[],y=null;const V=[0,1e3,3e3,5e3];let g=s(0),u=s("both"),v=s("eng"),K=s(!0),M=s(!0),xe=100,X=[1,2,3,5],S=s(0),w=s(X[0]),T=0,te=s(0),$=[];tt(async()=>{if(!e(A))return;const a=await fetch(`${e(I)}/sentences.json`);if(a.ok){const r=await a.json();t(d,r.sentences),t(Z,r.korean),t(P,r.explanations??[])}}),at(()=>{e(n)?.pause(),y&&clearTimeout(y)});async function m(a){a<0||a>=e(d).length||(a!==e(l)&&(T=0),t(l,a),await Pe(),document.getElementById(`s-${a}`)?.scrollIntoView({behavior:"smooth",block:"center"}),$=e(v)==="both"?["audio","audiok"]:e(v)==="kor"?["audiok"]:["audio"],await ae())}async function ae(){if(!$.length){t(p,!1);return}const a=$.shift();e(n).pause(),fe(n,e(n).src=`${e(I)}/${a}/${String(e(l)+1).padStart(2,"0")}.mp3`);try{await e(n).play(),t(p,!0)}catch{t(p,!1)}}function ke(){y=setTimeout(async()=>{if($.length)return await ae();if(e(o)==="one")return await m(e(l));if(e(o)==="all"){if(++T<e(w))return await m(e(l));T=0;const a=(e(l)+1)%e(d).length;if(!a&&Ve(te)>=xe){t(p,!1),t(o,"none");return}return await m(a)}++T<e(w)?await m(e(l)):t(p,!1)},V[e(g)])}const ye=()=>e(p)?(e(n).pause(),t(p,!1),$=[],y&&clearTimeout(y)):m(e(l)===-1?0:e(l)),we=()=>t(o,e(o)==="none"?"one":e(o)==="one"?"all":"none"),$e=()=>{e(o)!=="one"&&t(S,(e(S)+1)%X.length)},Ee=()=>t(v,e(v)==="eng"?"kor":e(v)==="kor"?"both":"eng"),Be=()=>{t(k,!e(k)),e(k)?(ee=[...e(d)],t(d,e(d).map(a=>{const r=a.split(" "),E=r.length,H=E<=2?1:E>=10?3:2,B=new Set;for(;B.size<H;)B.add(Math.floor(Math.random()*E));return r.map((c,f)=>B.has(f)?"____":c).join(" ")}))):t(d,[...ee])},Ce=()=>t(u,e(u)==="both"?"hideKor":e(u)==="hideKor"?"hideEng":"both"),Le=()=>t(g,(e(g)+1)%V.length),Ae=()=>t(M,!e(K));function Ke(a){switch(a.detail.id){case"play":ye();break;case"repeat":we();break;case"count":$e();break;case"disp":Ce();break;case"blank":Be();break;case"audio":Ee();break;case"gap":Le();break;case"exp":Ae();break}}i(()=>U(),()=>{t(A,U().url.pathname.match(/\/sentence\/([^\/]+)/)?.[1]||"")}),i(()=>e(A),()=>{t(I,`${ot}/assets/sentence/${e(A)}`)}),i(()=>e(S),()=>{t(w,X[e(S)])}),i(()=>e(K),()=>{t(W,e(K)?"calc(60px + env(safe-area-inset-bottom))":"env(safe-area-inset-bottom)")}),i(()=>e(o),()=>{e(o)!=="all"&&t(te,0)}),i(()=>e(n),()=>{e(n)&&fe(n,e(n).onended=ke)}),i(()=>e(g),()=>{t(R,e(g)?V[e(g)]/1e3+"s":"즉시")}),i(()=>e(u),()=>{t(z,e(u)==="both"?"한/영":e(u)==="hideKor"?"영":"한")}),i(()=>e(v),()=>{t(G,e(v)==="eng"?"영":e(v)==="kor"?"한":"모두")}),i(()=>e(M),()=>{t(N,e(M)?"설명ON":"설명OFF")}),i(()=>(e(p),e(o),e(w),e(z),e(k),e(G),e(R),e(N)),()=>{t(Y,[{id:"play",icon:e(p)?"⏸":"▶"},{id:"repeat",text:"반복:"+(e(o)==="none"?"없음":e(o)==="one"?"문장":"전체")},{id:"count",text:"횟수:"+e(w)+"x",active:e(o)!=="one"},{id:"disp",text:e(z)},{id:"blank",text:e(k)?"원문":"빈칸"},{id:"audio",text:"음성:"+e(G)},{id:"gap",text:"간격:"+e(R)},{id:"exp",text:e(N)}])}),Ge(),Ye();var se=ct(),j=pe(se),Me=_(j);{var Se=a=>{var r=Xe(),E=pe(r);He(E,1,()=>e(d),Je,(H,B,c)=>{var f=it();Qe(f,"id",`s-${c}`);var ne=_(f),re=_(ne);re.textContent=`${c+1}.`;var ie=L(re,2),q=_(ie);let le;var qe=_(q,!0);b(q);var O=L(q,2);let ce;var Oe=_(O,!0);b(O);var De=L(O,2);{var Fe=h=>{var x=rt();let de;var Ie=_(x,!0);b(x),J(Re=>{de=D(x,1,"ex svelte-1xcy4ta",null,de,Re),Q(Ie,e(P)[c])},[()=>({hidden:!e(M)})],ue),C(h,x)};me(De,h=>{e(P)[c]&&h(Fe)})}b(ie),b(ne),b(f),J((h,x)=>{D(f,1,`sent ${c===e(l)?"act":""}`,"svelte-1xcy4ta"),le=D(q,1,"en svelte-1xcy4ta",null,le,h),Q(qe,e(B)),ce=D(O,1,"ko svelte-1xcy4ta",null,ce,x),Q(Oe,e(Z)[c])},[()=>({hidden:e(u)==="hideEng"}),()=>({hidden:e(u)==="hideKor"})],ue),ve("click",f,()=>m(c)),ve("keydown",f,h=>["Enter"," "].includes(h.key)&&m(c)),C(H,f)}),C(a,r)},Te=a=>{var r=lt();C(a,r)};me(Me,a=>{e(d).length?a(Se):a(Te,!1)})}b(j);var oe=L(j,2);nt(oe,{get buttons(){return e(Y)},$$events:{click:Ke,toggle:a=>t(K,a.detail.visible)}});var je=L(oe,2);We(je,a=>t(n,a),()=>e(n)),J(()=>Ue(j,`bottom:${e(W)}`)),C(he,se),Ne(),ge()}export{Bt as component};
