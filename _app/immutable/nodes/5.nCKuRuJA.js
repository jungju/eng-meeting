import"../chunks/NZTpNUN0.js";import{i as Ce}from"../chunks/BNVjIjhF.js";import{p as De,a2 as A,a3 as Le,t as _,f as ee,a as c,b as Ae,l as a,g as e,s as v,m as s,a4 as Me,a8 as ze,a6 as le,d as i,r as l,a9 as Be,e as G,h as M,a5 as K,c as Re}from"../chunks/CX7M6nTm.js";import{i as z}from"../chunks/LrUez5h3.js";import{e as je,i as Ne}from"../chunks/DribQdv5.js";import{s as Oe}from"../chunks/BZO72TPf.js";import{b as Te}from"../chunks/7ANmUOF5.js";import{s as Ge,a as Ke}from"../chunks/CJtuwylV.js";import{o as We,a as Xe}from"../chunks/zff4H6P-.js";import{p as qe}from"../chunks/CAoeJScB.js";import{b as Fe}from"../chunks/D_HJ-Yzb.js";import{C as He}from"../chunks/J-pJPzLO.js";var Je=_('<div class="remain-big svelte-hathbp"> </div>'),Pe=_('<p class="eng svelte-hathbp"> </p>'),Qe=_('<p class="kor svelte-hathbp"> </p>'),Ue=_('<p class="placeholder svelte-hathbp">•••</p>'),Ve=_('<div role="button" tabindex="0"><div class="order-big svelte-hathbp"> </div> <!> <!></div> <button class="next-btn svelte-hathbp">NEXT ⏭</button>',1),Ye=_('<div class="result-item svelte-hathbp" role="button" tabindex="0"><span class="num svelte-hathbp"></span> <span class="eng txt svelte-hathbp"> </span> <span class="kor txt svelte-hathbp"> </span></div>'),Ze=_('<div class="result-list svelte-hathbp"><h2 class="svelte-hathbp">재생 순서 (클릭·Enter로 다시 듣기)</h2> <!></div>'),et=_('<main class="wrapper svelte-hathbp"><!> <!></main> <!> <audio playsinline="" preload="auto" class="svelte-hathbp"></audio>',1);function dt(pe,ce){De(ce,!1);const[ve,fe]=Ge(),te=()=>Ke(qe,"$page",ve),F=s(),H=s(),J=s(),P=s(),ae=s();let f=s([]),Q=s([]),d=s(-1),U=s(0),n=s(),y=s(!1),g=s(!1),x=!1;const W=[1e4,2e4,-1];let u=s(W[0]),b=s(0),$;const E=new Set;let w=s([]),S=s(!1);We(async()=>{const t=await fetch(`${e(H)}/sentences.json`);if(t.ok){const o=await t.json();a(f,o.sentences),a(Q,o.korean)}typeof window<"u"&&window.addEventListener("keydown",se)}),Xe(()=>{e(n)?.pause(),clearInterval($),typeof window<"u"&&window.removeEventListener("keydown",se)});function se(t){e(S)||(["Space","ArrowRight"].includes(t.code)?(t.preventDefault(),R()):t.code==="ArrowLeft"&&e(w).length>1&&(t.preventDefault(),e(w).pop(),B(e(w)[e(w).length-1],!1)))}function de(){if(E.size===e(f).length)return-1;let t;do t=Math.floor(Math.random()*e(f).length);while(E.has(t));return t}async function B(t,o=!0){if(!(t<0||t>=e(f).length)){o&&Me(U),a(d,t),E.add(t),o&&e(w).push(t),await ze(),e(n).pause(),le(n,e(n).src=`${e(H)}/audio/${String(t+1).padStart(2,"0")}.mp3`);try{await e(n).play(),a(y,!0)}catch{x=!0}}}function ue(){e(n)&&le(n,e(n).onended=()=>{if(a(y,!1),x){x=!1,R();return}if(e(u)>=0&&E.size<e(f).length){he();return}E.size===e(f).length&&a(S,!0)})}function he(){a(g,!0),a(b,Math.ceil(e(u)/1e3)),$=setInterval(()=>{Be(b,-1)<=0&&(clearInterval($),a(g,!1),e(y)?x=!0:R())},1e3)}function R(){e(n).pause(),clearInterval($),a(y,a(g,x=!1)),a(b,0);const t=de();if(t===-1){a(S,!0);return}B(t)}function ne(){e(d)===-1?R():B(e(d),!1)}function me(){e(n).pause(),clearInterval($),a(y,a(g,x=!1)),a(d,-1),a(U,0),a(b,0),E.clear(),a(w,[]),a(S,!1)}let p=s("none");function _e(){a(p,e(p)==="none"?"eng":e(p)==="eng"?"kor":"none")}function ge(t){a(u,t),e(g)&&(clearInterval($),a(g,!1),a(b,0))}function be(t){switch(t.detail.id){case"stop":me();break;case"show":_e();break;case"gap":ge(W[(W.indexOf(e(u))+1)%W.length]);break}}A(()=>te(),()=>{a(F,te().params.id)}),A(()=>e(F),()=>{a(H,`${Fe}/assets/sentence/${e(F)}`)}),A(()=>e(n),()=>{e(n)&&ue()}),A(()=>e(p),()=>{a(J,e(p)==="none"?"표시:없음":e(p)==="eng"?"표시:영어":"표시:한글")}),A(()=>e(u),()=>{a(P,e(u)<0?"무제한":`${e(u)/1e3}s`)}),A(()=>(e(J),e(P)),()=>{a(ae,[{id:"stop",icon:"⏹"},{id:"show",text:e(J)},{id:"gap",text:`간격:${e(P)}`}])}),Le(),Ce();var re=et(),V=ee(re),oe=i(V);{var we=t=>{var o=Ve(),h=ee(o),j=i(h),I=i(j,!0);l(j);var X=v(j,2);{var k=r=>{var m=Je(),C=i(m,!0);l(m),G(()=>M(C,e(b))),c(r,m)};z(X,r=>{e(u)>=0&&e(b)>0&&r(k)})}var q=v(X,2);{var N=r=>{var m=Re(),C=ee(m);{var $e=D=>{var O=Pe(),Z=i(O,!0);l(O),G(()=>M(Z,e(f)[e(d)])),c(D,O)},Ee=(D,O)=>{{var Z=L=>{var T=Qe(),Ie=i(T,!0);l(T),G(()=>M(Ie,e(Q)[e(d)])),c(L,T)},Se=L=>{var T=Ue();c(L,T)};z(D,L=>{e(p)==="kor"?L(Z):L(Se,!1)},O)}};z(C,D=>{e(p)==="eng"?D($e):D(Ee,!1)})}c(r,m)};z(q,r=>{e(d)!==-1&&r(N)})}l(h);var Y=v(h,2);G(()=>{Oe(h,1,`sentence-box ${e(y)||e(g)?"playing":""}`,"svelte-hathbp"),M(I,e(d)===-1?"Ready":`#${e(U)}`)}),K("click",h,ne),K("keydown",h,r=>{["Enter"," "].includes(r.key)&&(r.preventDefault(),ne())}),K("click",Y,R),c(t,o)};z(oe,t=>{e(S)||t(we)})}var ke=v(oe,2);{var ye=t=>{var o=Ze(),h=v(i(o),2);je(h,1,()=>e(w),Ne,(j,I,X)=>{var k=Ye(),q=i(k);q.textContent=`${X+1}.`;var N=v(q,2),Y=i(N,!0);l(N);var r=v(N,2),m=i(r,!0);l(r),l(k),G(()=>{M(Y,e(f)[e(I)]),M(m,e(Q)[e(I)])}),K("click",k,()=>B(e(I),!1)),K("keydown",k,C=>{["Enter"," "].includes(C.key)&&(C.preventDefault(),B(e(I),!1))}),c(j,k)}),l(o),c(t,o)};z(ke,t=>{e(S)&&t(ye)})}l(V);var ie=v(V,2);He(ie,{get buttons(){return e(ae)},$$events:{click:be,toggle:t=>a(p,t.detail.visible)}});var xe=v(ie,2);Te(xe,t=>a(n,t),()=>e(n)),c(pe,re),Ae(),fe()}export{dt as component};
