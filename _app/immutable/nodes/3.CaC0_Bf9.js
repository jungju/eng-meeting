import"../chunks/NZTpNUN0.js";import{i as Ht}from"../chunks/tEBiHiVF.js";import{q as Qt,D as S,F as Wt,u as _,G as T,v as c,w as Xt,g as t,m as r,s,y as f,x as n,z as h,I as X,A as k,C as w,J as Yt,K as Zt,M as Y,O as te}from"../chunks/CwV636Gc.js";import{i as z}from"../chunks/BpFCBlOt.js";import{e as kt,s as ee,i as wt}from"../chunks/lfAz8Y32.js";import{s as ae}from"../chunks/Bk8RznBR.js";import{b as se}from"../chunks/S5asknXf.js";import{s as re,a as oe}from"../chunks/C3Q7PnuQ.js";import{o as ne}from"../chunks/Dcbe9JOZ.js";import{b as ie}from"../chunks/3tUvlbEd.js";import{p as le}from"../chunks/B8zoCcxA.js";import{C as ce}from"../chunks/D51qih5w.js";var ve=_('<div class="timer svelte-1daikbg"> </div>'),de=_("<span></span> ",1),fe=_('<span class="revealed correct-word svelte-1daikbg"> </span> ',1),me=_('<span class="revealed wrong-word svelte-1daikbg"> </span> ',1),pe=_('<p class="kor svelte-1daikbg"> </p> <p class="eng svelte-1daikbg"></p>',1),ue=_('<button class="choice-btn svelte-1daikbg"> </button>'),he=_('<div class="choices svelte-1daikbg"></div>'),_e=_('<div class="sentence-box svelte-1daikbg"><div class="order-big svelte-1daikbg"> </div> <!> <!></div> <!>',1),ge=_('<div class="result-list svelte-1daikbg"><h2 class="svelte-1daikbg"> </h2> <h2 class="svelte-1daikbg"> </h2></div>'),xe=_('<main class="wrapper svelte-1daikbg"><!></main> <!> <audio playsinline="" preload="auto" class="svelte-1daikbg"></audio>',1);function Ee(Mt,$t){Qt($t,!1);const[St,yt]=re(),vt=()=>oe(le,"$page",St),Z=r(),R=r(),Bt=r(),E=r(),g=r(),dt=r(),ft=r(),mt=r(),pt=[10,20,50,-1],ut=[10,30,-1],It=/[.,!?]/g;let q=r(0),F=r(0),N=[],ht=r([]),tt=[],i=r([]),x=r([]),_t=r(),m=r(-1),et=r(0),at=r(!1),y=r(0),O=r(0),B=r(0),A=r(0),J;const P=new Set,K=e=>e.replace(It,""),Ct=e=>{for(let a=e.length-1;a>0;a--){const o=Math.floor(Math.random()*(a+1));[e[a],e[o]]=[e[o],e[a]]}return e},Tt=()=>{if(t(E)>=0&&P.size>=t(E)||P.size===N.length)return-1;let e;do e=Math.floor(Math.random()*N.length);while(P.has(e));return e};ne(async()=>{const e=await fetch(`${t(R)}/sentences.json`);if(!e.ok)return;const a=await e.json();N=a.sentences,s(ht,a.korean),tt=[...new Set(N.flatMap(o=>o.split(" ").map(K)))]});function zt(){L(),!(t(g)<0)&&(s(A,t(g)),J=setInterval(()=>{X(A,-1),t(A)<=0&&(L(),st())},1e3))}function L(){J&&clearInterval(J),J=void 0}function Et(e){const a=N[e].split(" "),o=new Set,p=Math.min(4,3+Math.floor(Math.random()*2));for(;o.size<Math.min(p,a.length);)o.add(Math.floor(Math.random()*a.length));s(x,[...o].map(l=>{const v=K(a[l]),b=new Set([v]);for(;b.size<10;)b.add(tt[Math.floor(Math.random()*tt.length)]);return{index:l,choices:Ct([...b])}}).sort((l,v)=>l.index-v.index)),s(i,a.map((l,v)=>{const b=o.has(v);return{text:l,isBlank:b,active:b&&v===t(x)[0].index,len:b?Math.max(K(l).length,3):0,result:void 0}})),s(y,0),zt()}function st(){const e=Tt();if(e===-1){s(at,!0),L();return}s(m,e),X(et),P.add(e),Et(e),s(B,t(B)+t(x).length)}function At(e){const{index:a}=t(x)[t(y)],o=K(t(i)[a].text),p=e===o;p&&X(O),Y(i,t(i)[a].isBlank=!1),Y(i,t(i)[a].active=!1),Y(i,t(i)[a].result=p?"correct":"wrong"),X(y),t(y)<t(x).length?Y(i,t(i)[t(x)[t(y)].index].active=!0):st()}function rt(){L(),s(m,-1),s(et,s(O,s(B,s(A,0)))),s(at,!1),P.clear(),s(i,[]),s(x,[])}function jt(e){const{id:a}=e.detail;a==="start"&&(t(m)===-1?st():rt()),a==="count"&&(s(q,(t(q)+1)%pt.length),rt()),a==="time"&&(s(F,(t(F)+1)%ut.length),rt())}S(()=>vt(),()=>{s(Z,vt().params.id)}),S(()=>t(Z),()=>{s(R,`${ie}/assets/sentence/${t(Z)}`)}),S(()=>t(R),()=>{s(Bt,`${t(R)}/audio`)}),S(()=>t(q),()=>{s(E,pt[t(q)])}),S(()=>t(F),()=>{s(g,ut[t(F)])}),S(()=>(t(B),t(O)),()=>{s(dt,t(B)?Math.round(t(O)/t(B)*100):0)}),S(()=>(t(g),t(A)),()=>{s(ft,t(g)<0?"∞":`${t(A)}s`)}),S(()=>(t(m),t(E),t(g)),()=>{s(mt,[{id:"start",icon:t(m)===-1?"▶":"⏹"},{id:"count",text:t(E)<0?"전체":`${t(E)}개`},{id:"time",text:t(g)<0?"∞":`${t(g)}s`}])}),Wt(),Ht();var gt=xe(),ot=T(gt),Gt=f(ot);{var Nt=e=>{var a=_e(),o=T(a),p=f(o),l=f(p,!0);n(p);var v=h(p,2);{var b=d=>{var u=ve(),I=f(u);n(u),k(()=>w(I,`⏱ ${t(ft)??""}`)),c(d,u)};z(v,d=>{t(g)>=0&&t(m)!==-1&&d(b)})}var Ut=h(v,2);{var Vt=d=>{var u=pe(),I=T(u),H=f(I,!0);n(I);var C=h(I,2);kt(C,5,()=>t(i),wt,(nt,M)=>{var bt=Yt(),qt=T(bt);{var Ft=j=>{var Q=de(),U=T(Q),it=h(U,1,!0);it.nodeValue=" ",k(()=>{ee(U,1,`blank ${t(M).active?"highlight":""}`,"svelte-1daikbg"),ae(U,`width:${t(M).len??""}ch;`)}),c(j,Q)},Jt=(j,Q)=>{{var U=G=>{var W=fe(),V=T(W),lt=f(V,!0);n(V);var $=h(V,1,!0);$.nodeValue=" ",k(()=>w(lt,t(M).text)),c(G,W)},it=(G,W)=>{{var V=$=>{var D=me(),ct=T(D),Kt=f(ct,!0);n(ct);var Lt=h(ct,1,!0);Lt.nodeValue=" ",k(()=>w(Kt,t(M).text)),c($,D)},lt=$=>{var D=te();k(()=>w(D,`${t(M).text??""} `)),c($,D)};z(G,$=>{t(M).result==="wrong"?$(V):$(lt,!1)},W)}};z(j,G=>{t(M).result==="correct"?G(U):G(it,!1)},Q)}};z(qt,j=>{t(M).isBlank?j(Ft):j(Jt,!1)})}c(nt,bt)}),n(C),k(()=>w(H,t(ht)[t(m)])),c(d,u)};z(Ut,d=>{t(m)!==-1&&d(Vt)})}n(o);var Dt=h(o,2);{var Rt=d=>{var u=he();kt(u,5,()=>t(x)[t(y)].choices,wt,(I,H)=>{var C=ue(),nt=f(C,!0);n(C),k(()=>w(nt,t(H))),Zt("click",C,()=>At(t(H))),c(I,C)}),n(u),c(d,u)};z(Dt,d=>{t(m)!==-1&&t(y)<t(x).length&&d(Rt)})}k(()=>w(l,t(m)===-1?"Ready":`#${t(et)}`)),c(e,a)},Ot=e=>{var a=ge(),o=f(a),p=f(o);n(o);var l=h(o,2),v=f(l);n(l),n(a),k(()=>{w(p,`정답 : ${t(O)??""} / ${t(B)??""}`),w(v,`점수 : ${t(dt)??""}점`)}),c(e,a)};z(Gt,e=>{t(at)?e(Ot,!1):e(Nt)})}n(ot);var xt=h(ot,2);ce(xt,{get buttons(){return t(mt)},$$events:{click:jt}});var Pt=h(xt,2);se(Pt,e=>s(_t,e),()=>t(_t)),c(Mt,gt),Xt(),yt()}export{Ee as component};
